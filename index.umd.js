(function(Ue,ie){typeof exports=="object"&&typeof module<"u"?ie(exports):typeof define=="function"&&define.amd?define(["exports"],ie):(Ue=typeof globalThis<"u"?globalThis:Ue||self,ie(Ue.webgis={}))})(this,function(Ue){"use strict";var ie=63710088e-1,hn={centimeters:ie*100,centimetres:ie*100,degrees:ie/111325,feet:ie*3.28084,inches:ie*39.37,kilometers:ie/1e3,kilometres:ie/1e3,meters:ie,metres:ie,miles:ie/1609.344,millimeters:ie*1e3,millimetres:ie*1e3,nauticalmiles:ie/1852,radians:1,yards:ie*1.0936};function ot(p,c,_){_===void 0&&(_={});var M={type:"Feature"};return(_.id===0||_.id)&&(M.id=_.id),_.bbox&&(M.bbox=_.bbox),M.properties=c||{},M.geometry=p,M}function br(p,c,_){if(_===void 0&&(_={}),!p)throw new Error("coordinates is required");if(!Array.isArray(p))throw new Error("coordinates must be an Array");if(p.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!yn(p[0])||!yn(p[1]))throw new Error("coordinates must contain numbers");var M={type:"Point",coordinates:p};return ot(M,c,_)}function _r(p,c,_){_===void 0&&(_={});for(var M=0,L=p;M<L.length;M++){var N=L[M];if(N.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var A=0;A<N[N.length-1].length;A++)if(N[N.length-1][A]!==N[0][A])throw new Error("First and last Position are not equivalent.")}var P={type:"Polygon",coordinates:p};return ot(P,c,_)}function Er(p,c,_){if(_===void 0&&(_={}),p.length<2)throw new Error("coordinates must be an array of two or more positions");var M={type:"LineString",coordinates:p};return ot(M,c,_)}function xr(p,c){c===void 0&&(c="kilometers");var _=hn[c];if(!_)throw new Error(c+" units is invalid");return p*_}function wr(p,c){c===void 0&&(c="kilometers");var _=hn[c];if(!_)throw new Error(c+" units is invalid");return p/_}function gn(p){var c=p%(2*Math.PI);return c*180/Math.PI}function Be(p){var c=p%360;return c*Math.PI/180}function yn(p){return!isNaN(p)&&p!==null&&!Array.isArray(p)}function Gt(p){if(!p)throw new Error("coord is required");if(!Array.isArray(p)){if(p.type==="Feature"&&p.geometry!==null&&p.geometry.type==="Point")return p.geometry.coordinates;if(p.type==="Point")return p.coordinates}if(Array.isArray(p)&&p.length>=2&&!Array.isArray(p[0])&&!Array.isArray(p[1]))return p;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Tr(p,c,_,M){M===void 0&&(M={});var L=Gt(p),N=Be(L[0]),A=Be(L[1]),P=Be(_),U=wr(c,M.units),a=Math.asin(Math.sin(A)*Math.cos(U)+Math.cos(A)*Math.sin(U)*Math.cos(P)),u=N+Math.atan2(Math.sin(P)*Math.sin(U)*Math.cos(A),Math.cos(U)-Math.sin(A)*Math.sin(a)),y=gn(u),v=gn(a);return br([y,v],M.properties)}function Sr(p,c,_){_===void 0&&(_={});for(var M=_.steps||64,L=_.properties?_.properties:!Array.isArray(p)&&p.type==="Feature"&&p.properties?p.properties:{},N=[],A=0;A<M;A++)N.push(Tr(p,c,A*-360/M,_).geometry.coordinates);return N.push(N[0]),_r([N],L)}var He=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function mn(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var vn={exports:{}};(function(p,c){(function(_,M){p.exports=M()})(He,function(){var _=function(e,t){var n={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},r={on:function(i,s,m){if(n[i]===void 0)throw new Error("Invalid event type: "+i);n[i].push({selector:s,fn:m})},render:function(i){t.store.featureChanged(i)}},o=function(i,s){for(var m=n[i],E=m.length;E--;){var S=m[E];if(S.selector(s)){S.fn.call(r,s)||t.store.render(),t.ui.updateMapClasses();break}}};return e.start.call(r),{render:e.render,stop:function(){e.stop&&e.stop()},trash:function(){e.trash&&(e.trash(),t.store.render())},combineFeatures:function(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures:function(){e.uncombineFeatures&&e.uncombineFeatures()},drag:function(i){o("drag",i)},click:function(i){o("click",i)},mousemove:function(i){o("mousemove",i)},mousedown:function(i){o("mousedown",i)},mouseup:function(i){o("mouseup",i)},mouseout:function(i){o("mouseout",i)},keydown:function(i){o("keydown",i)},keyup:function(i){o("keyup",i)},touchstart:function(i){o("touchstart",i)},touchmove:function(i){o("touchmove",i)},touchend:function(i){o("touchend",i)},tap:function(i){o("tap",i)}}};function M(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function L(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){if(this instanceof r){var o=[null];o.push.apply(o,arguments);var i=Function.bind.apply(t,o);return new i}return t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var o=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,o.get?o:{enumerable:!0,get:function(){return e[r]}})}),n}var N={},A={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},P=A;function U(e){var t=0;if(e&&e.length>0){t+=Math.abs(a(e[0]));for(var n=1;n<e.length;n++)t-=Math.abs(a(e[n]))}return t}function a(e){var t,n,r,o,i,s,m=0,E=e.length;if(E>2){for(s=0;s<E;s++)s===E-2?(r=E-2,o=E-1,i=0):s===E-1?(r=E-1,o=0,i=1):(r=s,o=s+1,i=s+2),t=e[r],n=e[o],m+=(u(e[i][0])-u(t[0]))*Math.sin(u(n[1]));m=m*P.RADIUS*P.RADIUS/2}return m}function u(e){return e*Math.PI/180}N.geometry=function e(t){var n,r=0;switch(t.type){case"Polygon":return U(t.coordinates);case"MultiPolygon":for(n=0;n<t.coordinates.length;n++)r+=U(t.coordinates[n]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<t.geometries.length;n++)r+=e(t.geometries[n]);return r}},N.ring=a;var y={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},v={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},f={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},b={POLYGON:"polygon",LINE:"line_string",POINT:"point"},h={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},w={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},R={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},$={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},D={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},V={ACTIVE:"true",INACTIVE:"false"},Y=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Ee=-85,se=Object.freeze({__proto__:null,classes:y,sources:v,cursors:f,types:b,geojsonTypes:h,modes:w,events:R,updateActions:$,meta:D,activeStates:V,interactions:Y,LAT_MIN:-90,LAT_RENDERED_MIN:Ee,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),me={Point:0,LineString:1,MultiLineString:1,Polygon:2};function te(e,t){var n=me[e.geometry.type]-me[t.geometry.type];return n===0&&e.geometry.type===h.POLYGON?e.area-t.area:n}function de(e){return e.map(function(t){return t.geometry.type===h.POLYGON&&(t.area=N.geometry({type:h.FEATURE,property:{},geometry:t.geometry})),t}).sort(te).map(function(t){return delete t.area,t})}function Xe(e,t){return t===void 0&&(t=0),[[e.point.x-t,e.point.y-t],[e.point.x+t,e.point.y+t]]}function le(e){if(this._items={},this._nums={},this._length=e?e.length:0,e)for(var t=0,n=e.length;t<n;t++)this.add(e[t]),e[t]!==void 0&&(typeof e[t]=="string"?this._items[e[t]]=t:this._nums[e[t]]=t)}le.prototype.add=function(e){return this.has(e)||(this._length++,typeof e=="string"?this._items[e]=this._length:this._nums[e]=this._length),this},le.prototype.delete=function(e){return this.has(e)===!1||(this._length--,delete this._items[e],delete this._nums[e]),this},le.prototype.has=function(e){return(typeof e=="string"||typeof e=="number")&&(this._items[e]!==void 0||this._nums[e]!==void 0)},le.prototype.values=function(){var e=this,t=[];return Object.keys(this._items).forEach(function(n){t.push({k:n,v:e._items[n]})}),Object.keys(this._nums).forEach(function(n){t.push({k:JSON.parse(n),v:e._nums[n]})}),t.sort(function(n,r){return n.v-r.v}).map(function(n){return n.k})},le.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var ve=[D.FEATURE,D.MIDPOINT,D.VERTEX],Se={click:function(e,t,n){return Sn(e,t,n,n.options.clickBuffer)},touch:function(e,t,n){return Sn(e,t,n,n.options.touchBuffer)}};function Sn(e,t,n,r){if(n.map===null)return[];var o=e?Xe(e,r):t,i={};n.options.styles&&(i.layers=n.options.styles.map(function(S){return S.id}).filter(function(S){return n.map.getLayer(S)!=null}));var s=n.map.queryRenderedFeatures(o,i).filter(function(S){return ve.indexOf(S.properties.meta)!==-1}),m=new le,E=[];return s.forEach(function(S){var C=S.properties.id;m.has(C)||(m.add(C),E.push(S))}),de(E)}function pt(e,t){var n=Se.click(e,null,t),r={mouse:f.NONE};return n[0]&&(r.mouse=n[0].properties.active===V.ACTIVE?f.MOVE:f.POINTER,r.feature=n[0].properties.meta),t.events.currentModeName().indexOf("draw")!==-1&&(r.mouse=f.ADD),t.ui.queueMapClasses(r),t.ui.updateMapClasses(),n[0]}function zt(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}function Jt(e,t,n){n===void 0&&(n={});var r=n.fineTolerance!=null?n.fineTolerance:4,o=n.grossTolerance!=null?n.grossTolerance:12,i=n.interval!=null?n.interval:500;e.point=e.point||t.point,e.time=e.time||t.time;var s=zt(e.point,t.point);return s<r||s<o&&t.time-e.time<i}function Yt(e,t,n){n===void 0&&(n={});var r=n.tolerance!=null?n.tolerance:25,o=n.interval!=null?n.interval:250;return e.point=e.point||t.point,e.time=e.time||t.time,zt(e.point,t.point)<r&&t.time-e.time<o}var Cn={exports:{}},qt=Cn.exports=function(e,t){if(t||(t=16),e===void 0&&(e=128),e<=0)return"0";for(var n=Math.log(Math.pow(2,e))/Math.log(t),r=2;n===1/0;r*=2)n=Math.log(Math.pow(2,e/r))/Math.log(t)*r;var o=n-Math.floor(n),i="";for(r=0;r<Math.floor(n);r++)i=Math.floor(Math.random()*t).toString(t)+i;if(o){var s=Math.pow(t,o);i=Math.floor(Math.random()*s).toString(t)+i}var m=parseInt(i,t);return m!==1/0&&m>=Math.pow(2,e)?qt(e,t):i};qt.rack=function(e,t,n){var r=function(i){var s=0;do{if(s++>10){if(!n)throw new Error("too many ID collisions, use more bits");e+=n}var m=qt(e,t)}while(Object.hasOwnProperty.call(o,m));return o[m]=i,m},o=r.hats={};return r.get=function(i){return r.hats[i]},r.set=function(i,s){return r.hats[i]=s,r},r.bits=e||128,r.base=t||16,r};var Zt=M(Cn.exports),ce=function(e,t){this.ctx=e,this.properties=t.properties||{},this.coordinates=t.geometry.coordinates,this.id=t.id||Zt(),this.type=t.geometry.type};ce.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},ce.prototype.incomingCoords=function(e){this.setCoordinates(e)},ce.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},ce.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},ce.prototype.setProperty=function(e,t){this.properties[e]=t},ce.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:h.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},ce.prototype.internal=function(e){var t={id:this.id,meta:D.FEATURE,"meta:type":this.type,active:V.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(var n in this.properties)t["user_"+n]=this.properties[n];return{type:h.FEATURE,properties:t,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var je=function(e,t){ce.call(this,e,t)};(je.prototype=Object.create(ce.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},je.prototype.updateCoordinate=function(e,t,n){this.coordinates=arguments.length===3?[t,n]:[e,t],this.changed()},je.prototype.getCoordinate=function(){return this.getCoordinates()};var Ce=function(e,t){ce.call(this,e,t)};(Ce.prototype=Object.create(ce.prototype)).isValid=function(){return this.coordinates.length>1},Ce.prototype.addCoordinate=function(e,t,n){this.changed();var r=parseInt(e,10);this.coordinates.splice(r,0,[t,n])},Ce.prototype.getCoordinate=function(e){var t=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[t]))},Ce.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)},Ce.prototype.updateCoordinate=function(e,t,n){var r=parseInt(e,10);this.coordinates[r]=[t,n],this.changed()};var he=function(e,t){ce.call(this,e,t),this.coordinates=this.coordinates.map(function(n){return n.slice(0,-1)})};(he.prototype=Object.create(ce.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(e){return e.length>2})},he.prototype.incomingCoords=function(e){this.coordinates=e.map(function(t){return t.slice(0,-1)}),this.changed()},he.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},he.prototype.addCoordinate=function(e,t,n){this.changed();var r=e.split(".").map(function(o){return parseInt(o,10)});this.coordinates[r[0]].splice(r[1],0,[t,n])},he.prototype.removeCoordinate=function(e){this.changed();var t=e.split(".").map(function(r){return parseInt(r,10)}),n=this.coordinates[t[0]];n&&(n.splice(t[1],1),n.length<3&&this.coordinates.splice(t[0],1))},he.prototype.getCoordinate=function(e){var t=e.split(".").map(function(r){return parseInt(r,10)}),n=this.coordinates[t[0]];return JSON.parse(JSON.stringify(n[t[1]]))},he.prototype.getCoordinates=function(){return this.coordinates.map(function(e){return e.concat([e[0]])})},he.prototype.updateCoordinate=function(e,t,n){this.changed();var r=e.split("."),o=parseInt(r[0],10),i=parseInt(r[1],10);this.coordinates[o]===void 0&&(this.coordinates[o]=[]),this.coordinates[o][i]=[t,n]};var Dr={MultiPoint:je,MultiLineString:Ce,MultiPolygon:he},ht=function(e,t,n,r,o){var i=n.split("."),s=parseInt(i[0],10),m=i[1]?i.slice(1).join("."):null;return e[s][t](m,r,o)},pe=function(e,t){if(ce.call(this,e,t),delete this.coordinates,this.model=Dr[t.geometry.type],this.model===void 0)throw new TypeError(t.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(t.geometry.coordinates)};function B(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}(pe.prototype=Object.create(ce.prototype))._coordinatesToFeatures=function(e){var t=this,n=this.model.bind(this);return e.map(function(r){return new n(t.ctx,{id:Zt(),type:h.FEATURE,properties:{},geometry:{coordinates:r,type:t.type.replace("Multi","")}})})},pe.prototype.isValid=function(){return this.features.every(function(e){return e.isValid()})},pe.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()},pe.prototype.getCoordinate=function(e){return ht(this.features,"getCoordinate",e)},pe.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(e){return e.type===h.POLYGON?e.getCoordinates():e.coordinates})))},pe.prototype.updateCoordinate=function(e,t,n){ht(this.features,"updateCoordinate",e,t,n),this.changed()},pe.prototype.addCoordinate=function(e,t,n){ht(this.features,"addCoordinate",e,t,n),this.changed()},pe.prototype.removeCoordinate=function(e){ht(this.features,"removeCoordinate",e),this.changed()},pe.prototype.getFeatures=function(){return this.features},B.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)},B.prototype.setSelectedCoordinates=function(e){var t=this;this._ctx.store.setSelectedCoordinates(e),e.reduce(function(n,r){return n[r.feature_id]===void 0&&(n[r.feature_id]=!0,t._ctx.store.get(r.feature_id).changed()),n},{})},B.prototype.getSelected=function(){return this._ctx.store.getSelected()},B.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},B.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)},B.prototype.getFeature=function(e){return this._ctx.store.get(e)},B.prototype.select=function(e){return this._ctx.store.select(e)},B.prototype.deselect=function(e){return this._ctx.store.deselect(e)},B.prototype.deleteFeature=function(e,t){return t===void 0&&(t={}),this._ctx.store.delete(e,t)},B.prototype.addFeature=function(e){return this._ctx.store.add(e)},B.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},B.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},B.prototype.setActionableState=function(e){e===void 0&&(e={});var t={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(t)},B.prototype.changeMode=function(e,t,n){return t===void 0&&(t={}),n===void 0&&(n={}),this._ctx.events.changeMode(e,t,n)},B.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)},B.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)},B.prototype.featuresAt=function(e,t,n){if(n===void 0&&(n="click"),n!=="click"&&n!=="touch")throw new Error("invalid buffer type");return Se[n](e,t,this._ctx)},B.prototype.newFeature=function(e){var t=e.geometry.type;return t===h.POINT?new je(this._ctx,e):t===h.LINE_STRING?new Ce(this._ctx,e):t===h.POLYGON?new he(this._ctx,e):new pe(this._ctx,e)},B.prototype.isInstanceOf=function(e,t){if(e===h.POINT)return t instanceof je;if(e===h.LINE_STRING)return t instanceof Ce;if(e===h.POLYGON)return t instanceof he;if(e==="MultiFeature")return t instanceof pe;throw new Error("Unknown feature class: "+e)},B.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)},B.prototype.onSetup=function(){},B.prototype.onDrag=function(){},B.prototype.onClick=function(){},B.prototype.onMouseMove=function(){},B.prototype.onMouseDown=function(){},B.prototype.onMouseUp=function(){},B.prototype.onMouseOut=function(){},B.prototype.onKeyUp=function(){},B.prototype.onKeyDown=function(){},B.prototype.onTouchStart=function(){},B.prototype.onTouchMove=function(){},B.prototype.onTouchEnd=function(){},B.prototype.onTap=function(){},B.prototype.onStop=function(){},B.prototype.onTrash=function(){},B.prototype.onCombineFeature=function(){},B.prototype.onUncombineFeature=function(){},B.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Mn={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Ur=Object.keys(Mn);function Br(e){var t=Object.keys(e);return function(n,r){r===void 0&&(r={});var o={},i=t.reduce(function(s,m){return s[m]=e[m],s},new B(n));return{start:function(){var s=this;o=i.onSetup(r),Ur.forEach(function(m){var E,S=Mn[m],C=function(){return!1};e[S]&&(C=function(){return!0}),s.on(m,C,(E=S,function(x){return i[E](o,x)}))})},stop:function(){i.onStop(o)},trash:function(){i.onTrash(o)},combineFeatures:function(){i.onCombineFeatures(o)},uncombineFeatures:function(){i.onUncombineFeatures(o)},render:function(s,m){i.toDisplayFeatures(o,s,m)}}}}function it(e){return[].concat(e).filter(function(t){return t!==void 0})}function jr(){var e=this;if(!(e.ctx.map&&e.ctx.map.getSource(v.HOT)!==void 0))return E();var t=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:t});var n=[],r=[];e.isDirty?r=e.getAllIds():(n=e.getChangedIds().filter(function(S){return e.get(S)!==void 0}),r=e.sources.hot.filter(function(S){return S.properties.id&&n.indexOf(S.properties.id)===-1&&e.get(S.properties.id)!==void 0}).map(function(S){return S.properties.id})),e.sources.hot=[];var o=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter(function(S){var C=S.properties.id||S.properties.parent;return n.indexOf(C)===-1});var i=o!==e.sources.cold.length||r.length>0;function s(S,C){var x=e.get(S).internal(t);e.ctx.events.currentModeRender(x,function(F){e.sources[C].push(F)})}if(n.forEach(function(S){return s(S,"hot")}),r.forEach(function(S){return s(S,"cold")}),i&&e.ctx.map.getSource(v.COLD).setData({type:h.FEATURE_COLLECTION,features:e.sources.cold}),e.ctx.map.getSource(v.HOT).setData({type:h.FEATURE_COLLECTION,features:e.sources.hot}),e._emitSelectionChange&&(e.ctx.map.fire(R.SELECTION_CHANGE,{features:e.getSelected().map(function(S){return S.toGeoJSON()}),points:e.getSelectedCoordinates().map(function(S){return{type:h.FEATURE,properties:{},geometry:{type:h.POINT,coordinates:S.coordinates}}})}),e._emitSelectionChange=!1),e._deletedFeaturesToEmit.length){var m=e._deletedFeaturesToEmit.map(function(S){return S.toGeoJSON()});e._deletedFeaturesToEmit=[],e.ctx.map.fire(R.DELETE,{features:m})}function E(){e.isDirty=!1,e.clearChangedIds()}E(),e.ctx.map.fire(R.RENDER,{})}function q(e){var t,n=this;this._features={},this._featureIds=new le,this._selectedFeatureIds=new le,this._selectedCoordinates=[],this._changedFeatureIds=new le,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]},this.render=function(){t||(t=requestAnimationFrame(function(){t=null,jr.call(n)}))},this.isDirty=!1}function On(e,t){var n=e._selectedCoordinates.filter(function(r){return e._selectedFeatureIds.has(r.feature_id)});e._selectedCoordinates.length===n.length||t.silent||(e._emitSelectionChange=!0),e._selectedCoordinates=n}q.prototype.createRenderBatch=function(){var e=this,t=this.render,n=0;return this.render=function(){n++},function(){e.render=t,n>0&&e.render()}},q.prototype.setDirty=function(){return this.isDirty=!0,this},q.prototype.featureChanged=function(e){return this._changedFeatureIds.add(e),this},q.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},q.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},q.prototype.getAllIds=function(){return this._featureIds.values()},q.prototype.add=function(e){return this.featureChanged(e.id),this._features[e.id]=e,this._featureIds.add(e.id),this},q.prototype.delete=function(e,t){var n=this;return t===void 0&&(t={}),it(e).forEach(function(r){n._featureIds.has(r)&&(n._featureIds.delete(r),n._selectedFeatureIds.delete(r),t.silent||n._deletedFeaturesToEmit.indexOf(n._features[r])===-1&&n._deletedFeaturesToEmit.push(n._features[r]),delete n._features[r],n.isDirty=!0)}),On(this,t),this},q.prototype.get=function(e){return this._features[e]},q.prototype.getAll=function(){var e=this;return Object.keys(this._features).map(function(t){return e._features[t]})},q.prototype.select=function(e,t){var n=this;return t===void 0&&(t={}),it(e).forEach(function(r){n._selectedFeatureIds.has(r)||(n._selectedFeatureIds.add(r),n._changedFeatureIds.add(r),t.silent||(n._emitSelectionChange=!0))}),this},q.prototype.deselect=function(e,t){var n=this;return t===void 0&&(t={}),it(e).forEach(function(r){n._selectedFeatureIds.has(r)&&(n._selectedFeatureIds.delete(r),n._changedFeatureIds.add(r),t.silent||(n._emitSelectionChange=!0))}),On(this,t),this},q.prototype.clearSelected=function(e){return e===void 0&&(e={}),this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this},q.prototype.setSelected=function(e,t){var n=this;return t===void 0&&(t={}),e=it(e),this.deselect(this._selectedFeatureIds.values().filter(function(r){return e.indexOf(r)===-1}),{silent:t.silent}),this.select(e.filter(function(r){return!n._selectedFeatureIds.has(r)}),{silent:t.silent}),this},q.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this},q.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},q.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},q.prototype.getSelected=function(){var e=this;return this._selectedFeatureIds.values().map(function(t){return e.get(t)})},q.prototype.getSelectedCoordinates=function(){var e=this;return this._selectedCoordinates.map(function(t){return{coordinates:e.get(t.feature_id).getCoordinate(t.coord_path)}})},q.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)},q.prototype.setFeatureProperty=function(e,t,n){this.get(e).setProperty(t,n),this.featureChanged(e)},q.prototype.storeMapConfig=function(){var e=this;Y.forEach(function(t){e.ctx.map[t]&&(e._mapInitialConfig[t]=e.ctx.map[t].isEnabled())})},q.prototype.restoreMapConfig=function(){var e=this;Object.keys(this._mapInitialConfig).forEach(function(t){e._mapInitialConfig[t]?e.ctx.map[t].enable():e.ctx.map[t].disable()})},q.prototype.getInitialConfigValue=function(e){return this._mapInitialConfig[e]===void 0||this._mapInitialConfig[e]};var $r=function(){for(var e=arguments,t={},n=0;n<arguments.length;n++){var r=e[n];for(var o in r)Vr.call(r,o)&&(t[o]=r[o])}return t},Vr=Object.prototype.hasOwnProperty,Ne=M($r),Gr=["mode","feature","mouse"];function zr(e){var t=null,n=null,r={onRemove:function(){return e.map.off("load",r.connect),clearInterval(n),r.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.boxZoomInitial&&e.map.boxZoom.enable(),e.map=null,e.container=null,e.store=null,t&&t.parentNode&&t.parentNode.removeChild(t),t=null,this},connect:function(){e.map.off("load",r.connect),clearInterval(n),r.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd:function(o){var i=o.fire;return o.fire=function(s,m){var E=arguments;return i.length===1&&arguments.length!==1&&(E=[Ne({},{type:s},m)]),i.apply(o,E)},e.map=o,e.events=function(s){var m=Object.keys(s.options.modes).reduce(function(g,O){return g[O]=Br(s.options.modes[O]),g},{}),E={},S={},C={},x=null,F=null;C.drag=function(g,O){O({point:g.point,time:new Date().getTime()})?(s.ui.queueMapClasses({mouse:f.DRAG}),F.drag(g)):g.originalEvent.stopPropagation()},C.mousedrag=function(g){C.drag(g,function(O){return!Jt(E,O)})},C.touchdrag=function(g){C.drag(g,function(O){return!Yt(S,O)})},C.mousemove=function(g){if((g.originalEvent.buttons!==void 0?g.originalEvent.buttons:g.originalEvent.which)===1)return C.mousedrag(g);var O=pt(g,s);g.featureTarget=O,F.mousemove(g)},C.mousedown=function(g){E={time:new Date().getTime(),point:g.point};var O=pt(g,s);g.featureTarget=O,F.mousedown(g)},C.mouseup=function(g){var O=pt(g,s);g.featureTarget=O,Jt(E,{point:g.point,time:new Date().getTime()})?F.click(g):F.mouseup(g)},C.mouseout=function(g){F.mouseout(g)},C.touchstart=function(g){if(s.options.touchEnabled){S={time:new Date().getTime(),point:g.point};var O=Se.touch(g,null,s)[0];g.featureTarget=O,F.touchstart(g)}},C.touchmove=function(g){if(s.options.touchEnabled)return F.touchmove(g),C.touchdrag(g)},C.touchend=function(g){if(g.originalEvent.preventDefault(),s.options.touchEnabled){var O=Se.touch(g,null,s)[0];g.featureTarget=O,Yt(S,{time:new Date().getTime(),point:g.point})?F.tap(g):F.touchend(g)}};var X=function(g){return!(g===8||g===46||g>=48&&g<=57)};function k(g,O,G){G===void 0&&(G={}),F.stop();var ae=m[g];if(ae===void 0)throw new Error(g+" is not valid");x=g;var Q=ae(s,O);F=_(Q,s),G.silent||s.map.fire(R.MODE_CHANGE,{mode:g}),s.store.setDirty(),s.store.render()}C.keydown=function(g){(g.srcElement||g.target).classList.contains("mapboxgl-canvas")&&(g.keyCode!==8&&g.keyCode!==46||!s.options.controls.trash?X(g.keyCode)?F.keydown(g):g.keyCode===49&&s.options.controls.point?k(w.DRAW_POINT):g.keyCode===50&&s.options.controls.line_string?k(w.DRAW_LINE_STRING):g.keyCode===51&&s.options.controls.polygon&&k(w.DRAW_POLYGON):(g.preventDefault(),F.trash()))},C.keyup=function(g){X(g.keyCode)&&F.keyup(g)},C.zoomend=function(){s.store.changeZoom()},C.data=function(g){if(g.dataType==="style"){var O=s.setup,G=s.map,ae=s.options,Q=s.store;ae.styles.some(function(nn){return G.getLayer(nn.id)})||(O.addLayers(),Q.setDirty(),Q.render())}};var W={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){x=s.options.defaultMode,F=_(m[x](s),s)},changeMode:k,actionable:function(g){var O=!1;Object.keys(g).forEach(function(G){if(W[G]===void 0)throw new Error("Invalid action type");W[G]!==g[G]&&(O=!0),W[G]=g[G]}),O&&s.map.fire(R.ACTIONABLE,{actions:W})},currentModeName:function(){return x},currentModeRender:function(g,O){return F.render(g,O)},fire:function(g,O){C[g]&&C[g](O)},addEventListeners:function(){s.map.on("mousemove",C.mousemove),s.map.on("mousedown",C.mousedown),s.map.on("mouseup",C.mouseup),s.map.on("data",C.data),s.map.on("touchmove",C.touchmove),s.map.on("touchstart",C.touchstart),s.map.on("touchend",C.touchend),s.container.addEventListener("mouseout",C.mouseout),s.options.keybindings&&(s.container.addEventListener("keydown",C.keydown),s.container.addEventListener("keyup",C.keyup))},removeEventListeners:function(){s.map.off("mousemove",C.mousemove),s.map.off("mousedown",C.mousedown),s.map.off("mouseup",C.mouseup),s.map.off("data",C.data),s.map.off("touchmove",C.touchmove),s.map.off("touchstart",C.touchstart),s.map.off("touchend",C.touchend),s.container.removeEventListener("mouseout",C.mouseout),s.options.keybindings&&(s.container.removeEventListener("keydown",C.keydown),s.container.removeEventListener("keyup",C.keyup))},trash:function(g){F.trash(g)},combineFeatures:function(){F.combineFeatures()},uncombineFeatures:function(){F.uncombineFeatures()},getMode:function(){return x}}}(e),e.ui=function(s){var m={},E=null,S={mode:null,feature:null,mouse:null},C={mode:null,feature:null,mouse:null};function x(g){C=Ne(C,g)}function F(){var g,O;if(s.container){var G=[],ae=[];Gr.forEach(function(Q){C[Q]!==S[Q]&&(G.push(Q+"-"+S[Q]),C[Q]!==null&&ae.push(Q+"-"+C[Q]))}),G.length>0&&(g=s.container.classList).remove.apply(g,G),ae.length>0&&(O=s.container.classList).add.apply(O,ae),S=Ne(S,C)}}function X(g,O){O===void 0&&(O={});var G=document.createElement("button");return G.className=y.CONTROL_BUTTON+" "+O.className,G.setAttribute("title",O.title),O.container.appendChild(G),G.addEventListener("click",function(ae){if(ae.preventDefault(),ae.stopPropagation(),ae.target===E)return k(),void O.onDeactivate();W(g),O.onActivate()},!0),G}function k(){E&&(E.classList.remove(y.ACTIVE_BUTTON),E=null)}function W(g){k();var O=m[g];O&&O&&g!=="trash"&&(O.classList.add(y.ACTIVE_BUTTON),E=O)}return{setActiveButton:W,queueMapClasses:x,updateMapClasses:F,clearMapClasses:function(){x({mode:null,feature:null,mouse:null}),F()},addButtons:function(){var g=s.options.controls,O=document.createElement("div");return O.className=y.CONTROL_GROUP+" "+y.CONTROL_BASE,g&&(g[b.LINE]&&(m[b.LINE]=X(b.LINE,{container:O,className:y.CONTROL_BUTTON_LINE,title:"LineString tool "+(s.options.keybindings?"(l)":""),onActivate:function(){return s.events.changeMode(w.DRAW_LINE_STRING)},onDeactivate:function(){return s.events.trash()}})),g[b.POLYGON]&&(m[b.POLYGON]=X(b.POLYGON,{container:O,className:y.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(s.options.keybindings?"(p)":""),onActivate:function(){return s.events.changeMode(w.DRAW_POLYGON)},onDeactivate:function(){return s.events.trash()}})),g[b.POINT]&&(m[b.POINT]=X(b.POINT,{container:O,className:y.CONTROL_BUTTON_POINT,title:"Marker tool "+(s.options.keybindings?"(m)":""),onActivate:function(){return s.events.changeMode(w.DRAW_POINT)},onDeactivate:function(){return s.events.trash()}})),g.trash&&(m.trash=X("trash",{container:O,className:y.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){s.events.trash()}})),g.combine_features&&(m.combine_features=X("combineFeatures",{container:O,className:y.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){s.events.combineFeatures()}})),g.uncombine_features&&(m.uncombine_features=X("uncombineFeatures",{container:O,className:y.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){s.events.uncombineFeatures()}}))),O},removeButtons:function(){Object.keys(m).forEach(function(g){var O=m[g];O.parentNode&&O.parentNode.removeChild(O),delete m[g]})}}}(e),e.container=o.getContainer(),e.store=new q(e),t=e.ui.addButtons(),e.options.boxSelect&&(e.boxZoomInitial=o.boxZoom.isEnabled(),o.boxZoom.disable(),o.dragPan.disable(),o.dragPan.enable()),o.loaded()?r.connect():(o.on("load",r.connect),n=setInterval(function(){o.loaded()&&r.connect()},16)),e.events.start(),t},addLayers:function(){e.map.addSource(v.COLD,{data:{type:h.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(v.HOT,{data:{type:h.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach(function(o){e.map.addLayer(o)}),e.store.setDirty(!0),e.store.render()},removeLayers:function(){e.options.styles.forEach(function(o){e.map.getLayer(o.id)&&e.map.removeLayer(o.id)}),e.map.getSource(v.COLD)&&e.map.removeSource(v.COLD),e.map.getSource(v.HOT)&&e.map.removeSource(v.HOT)}};return e.setup=r,r}var Pn=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function gt(e){return function(t){var n=t.featureTarget;return!!n&&!!n.properties&&n.properties.meta===e}}function In(e){return!!e.originalEvent&&!!e.originalEvent.shiftKey&&e.originalEvent.button===0}function $e(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===V.ACTIVE&&e.featureTarget.properties.meta===D.FEATURE}function Ht(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===V.INACTIVE&&e.featureTarget.properties.meta===D.FEATURE}function yt(e){return e.featureTarget===void 0}function Xt(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.meta===D.FEATURE}function at(e){var t=e.featureTarget;return!!t&&!!t.properties&&t.properties.meta===D.VERTEX}function mt(e){return!!e.originalEvent&&e.originalEvent.shiftKey===!0}function vt(e){return e.keyCode===27}function bt(e){return e.keyCode===13}var Jr=Object.freeze({__proto__:null,isOfMetaType:gt,isShiftMousedown:In,isActiveFeature:$e,isInactiveFeature:Ht,noTarget:yt,isFeature:Xt,isVertex:at,isShiftDown:mt,isEscapeKey:vt,isEnterKey:bt,isTrue:function(){return!0}}),Yr=Ke;function Ke(e,t){this.x=e,this.y=t}Ke.prototype={clone:function(){return new Ke(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=t*this.x-n*this.y,o=n*this.x+t*this.y;return this.x=r,this.y=o,this},_rotateAround:function(e,t){var n=Math.cos(e),r=Math.sin(e),o=t.x+n*(this.x-t.x)-r*(this.y-t.y),i=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=o,this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ke.convert=function(e){return e instanceof Ke?e:Array.isArray(e)?new Ke(e[0],e[1]):e};var qr=M(Yr);function Kt(e,t){var n=t.getBoundingClientRect();return new qr(e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0))}function We(e,t,n,r){return{type:h.FEATURE,properties:{meta:D.VERTEX,parent:e,coord_path:n,active:r?V.ACTIVE:V.INACTIVE},geometry:{type:h.POINT,coordinates:t}}}function Ln(e,t,n){var r=t.geometry.coordinates,o=n.geometry.coordinates;if(r[1]>85||r[1]<Ee||o[1]>85||o[1]<Ee)return null;var i={lng:(r[0]+o[0])/2,lat:(r[1]+o[1])/2};return{type:h.FEATURE,properties:{meta:D.MIDPOINT,parent:e,lng:i.lng,lat:i.lat,coord_path:n.properties.coord_path},geometry:{type:h.POINT,coordinates:[i.lng,i.lat]}}}function _t(e,t,n){t===void 0&&(t={}),n===void 0&&(n=null);var r,o=e.geometry,i=o.type,s=o.coordinates,m=e.properties&&e.properties.id,E=[];function S(x,F){var X="",k=null;x.forEach(function(W,g){var O=F!=null?F+"."+g:String(g),G=We(m,W,O,C(O));if(t.midpoints&&k){var ae=Ln(m,k,G);ae&&E.push(ae)}k=G;var Q=JSON.stringify(W);X!==Q&&E.push(G),g===0&&(X=Q)})}function C(x){return!!t.selectedPaths&&t.selectedPaths.indexOf(x)!==-1}return i===h.POINT?E.push(We(m,s,n,C(n))):i===h.POLYGON?s.forEach(function(x,F){S(x,n!==null?n+"."+F:String(F))}):i===h.LINE_STRING?S(s,n):i.indexOf(h.MULTI_PREFIX)===0&&(r=i.replace(h.MULTI_PREFIX,""),s.forEach(function(x,F){var X={type:h.FEATURE,properties:e.properties,geometry:{type:r,coordinates:x}};E=E.concat(_t(X,t,F))})),E}var be={enable:function(e){setTimeout(function(){e.map&&e.map.doubleClickZoom&&e._ctx&&e._ctx.store&&e._ctx.store.getInitialConfigValue&&e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable:function(e){setTimeout(function(){e.map&&e.map.doubleClickZoom&&e.map.doubleClickZoom.disable()},0)}},Et={exports:{}},Nn=function(e){if(!e||!e.type)return null;var t=Zr[e.type];if(!t)return null;if(t==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]};if(t==="feature")return{type:"FeatureCollection",features:[e]};if(t==="featurecollection")return e},Zr={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Hr=M(Nn),Xr=Object.freeze({__proto__:null,default:function e(t){switch(t&&t.type||null){case"FeatureCollection":return t.features=t.features.reduce(function(n,r){return n.concat(e(r))},[]),t;case"Feature":return t.geometry?e(t.geometry).map(function(n){var r={type:"Feature",properties:JSON.parse(JSON.stringify(t.properties)),geometry:n};return t.id!==void 0&&(r.id=t.id),r}):[t];case"MultiPoint":return t.coordinates.map(function(n){return{type:"Point",coordinates:n}});case"MultiPolygon":return t.coordinates.map(function(n){return{type:"Polygon",coordinates:n}});case"MultiLineString":return t.coordinates.map(function(n){return{type:"LineString",coordinates:n}});case"GeometryCollection":return t.geometries.map(e).reduce(function(n,r){return n.concat(r)},[]);case"Point":case"Polygon":case"LineString":return[t]}}}),Kr=Nn,xt=L(Xr),Wr=function(e){return function t(n){return Array.isArray(n)&&n.length&&typeof n[0]=="number"?[n]:n.reduce(function(r,o){return Array.isArray(o)&&Array.isArray(o[0])?r.concat(t(o)):(r.push(o),r)},[])}(e)};xt instanceof Function||(xt=xt.default);var Fn={exports:{}},Qr=Fn.exports=function(e){return new ge(e)};function ge(e){this.value=e}function An(e,t,n){var r=[],o=[],i=!0;return function s(m){var E=n?kn(m):m,S={},C=!0,x={node:E,node_:m,path:[].concat(r),parent:o[o.length-1],parents:o,key:r.slice(-1)[0],isRoot:r.length===0,level:r.length,circular:null,update:function(k,W){x.isRoot||(x.parent.node[x.key]=k),x.node=k,W&&(C=!1)},delete:function(k){delete x.parent.node[x.key],k&&(C=!1)},remove:function(k){Rn(x.parent.node)?x.parent.node.splice(x.key,1):delete x.parent.node[x.key],k&&(C=!1)},keys:null,before:function(k){S.before=k},after:function(k){S.after=k},pre:function(k){S.pre=k},post:function(k){S.post=k},stop:function(){i=!1},block:function(){C=!1}};if(!i)return x;function F(){if(typeof x.node=="object"&&x.node!==null){x.keys&&x.node_===x.node||(x.keys=wt(x.node)),x.isLeaf=x.keys.length==0;for(var k=0;k<o.length;k++)if(o[k].node_===m){x.circular=o[k];break}}else x.isLeaf=!0,x.keys=null;x.notLeaf=!x.isLeaf,x.notRoot=!x.isRoot}F();var X=t.call(x,x.node);return X!==void 0&&x.update&&x.update(X),S.before&&S.before.call(x,x.node),C&&(typeof x.node!="object"||x.node===null||x.circular||(o.push(x),F(),Tt(x.keys,function(k,W){r.push(k),S.pre&&S.pre.call(x,x.node[k],k);var g=s(x.node[k]);n&&St.call(x.node,k)&&(x.node[k]=g.node),g.isLast=W==x.keys.length-1,g.isFirst=W==0,S.post&&S.post.call(x,g),r.pop()}),o.pop()),S.after&&S.after.call(x,x.node)),x}(e).node}function kn(e){if(typeof e=="object"&&e!==null){var t;if(Rn(e))t=[];else if(Qe(e)==="[object Date]")t=new Date(e.getTime?e.getTime():e);else if(function(o){return Qe(o)==="[object RegExp]"}(e))t=new RegExp(e);else if(function(o){return Qe(o)==="[object Error]"}(e))t={message:e.message};else if(function(o){return Qe(o)==="[object Boolean]"}(e))t=new Boolean(e);else if(function(o){return Qe(o)==="[object Number]"}(e))t=new Number(e);else if(function(o){return Qe(o)==="[object String]"}(e))t=new String(e);else if(Object.create&&Object.getPrototypeOf)t=Object.create(Object.getPrototypeOf(e));else if(e.constructor===Object)t={};else{var n=e.constructor&&e.constructor.prototype||e.__proto__||{},r=function(){};r.prototype=n,t=new r}return Tt(wt(e),function(o){t[o]=e[o]}),t}return e}ge.prototype.get=function(e){for(var t=this.value,n=0;n<e.length;n++){var r=e[n];if(!t||!St.call(t,r)){t=void 0;break}t=t[r]}return t},ge.prototype.has=function(e){for(var t=this.value,n=0;n<e.length;n++){var r=e[n];if(!t||!St.call(t,r))return!1;t=t[r]}return!0},ge.prototype.set=function(e,t){for(var n=this.value,r=0;r<e.length-1;r++){var o=e[r];St.call(n,o)||(n[o]={}),n=n[o]}return n[e[r]]=t,t},ge.prototype.map=function(e){return An(this.value,e,!0)},ge.prototype.forEach=function(e){return this.value=An(this.value,e,!1),this.value},ge.prototype.reduce=function(e,t){var n=arguments.length===1,r=n?this.value:t;return this.forEach(function(o){this.isRoot&&n||(r=e.call(this,r,o))}),r},ge.prototype.paths=function(){var e=[];return this.forEach(function(t){e.push(this.path)}),e},ge.prototype.nodes=function(){var e=[];return this.forEach(function(t){e.push(this.node)}),e},ge.prototype.clone=function(){var e=[],t=[];return function n(r){for(var o=0;o<e.length;o++)if(e[o]===r)return t[o];if(typeof r=="object"&&r!==null){var i=kn(r);return e.push(r),t.push(i),Tt(wt(r),function(s){i[s]=n(r[s])}),e.pop(),t.pop(),i}return r}(this.value)};var wt=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};function Qe(e){return Object.prototype.toString.call(e)}var Rn=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},Tt=function(e,t){if(e.forEach)return e.forEach(t);for(var n=0;n<e.length;n++)t(e[n],n,e)};Tt(wt(ge.prototype),function(e){Qr[e]=function(t){var n=[].slice.call(arguments,1),r=new ge(t);return r[e].apply(r,n)}});var St=Object.hasOwnProperty||function(e,t){return t in e},eo=Fn.exports,to=ue;function ue(e){if(!(this instanceof ue))return new ue(e);this._bbox=e||[1/0,1/0,-1/0,-1/0],this._valid=!!e}ue.prototype.include=function(e){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],e[0]),this._bbox[1]=Math.min(this._bbox[1],e[1]),this._bbox[2]=Math.max(this._bbox[2],e[0]),this._bbox[3]=Math.max(this._bbox[3],e[1]),this},ue.prototype.equals=function(e){var t;return t=e instanceof ue?e.bbox():e,this._bbox[0]==t[0]&&this._bbox[1]==t[1]&&this._bbox[2]==t[2]&&this._bbox[3]==t[3]},ue.prototype.center=function(e){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},ue.prototype.union=function(e){var t;return this._valid=!0,t=e instanceof ue?e.bbox():e,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[2]),this._bbox[3]=Math.max(this._bbox[3],t[3]),this},ue.prototype.bbox=function(){return this._valid?this._bbox:null},ue.prototype.contains=function(e){if(!e)return this._fastContains();if(!this._valid)return null;var t=e[0],n=e[1];return this._bbox[0]<=t&&this._bbox[1]<=n&&this._bbox[2]>=t&&this._bbox[3]>=n},ue.prototype.intersect=function(e){return this._valid?(t=e instanceof ue?e.bbox():e,!(this._bbox[0]>t[2]||this._bbox[2]<t[0]||this._bbox[3]<t[1]||this._bbox[1]>t[3])):null;var t},ue.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var e="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",e)},ue.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var no=function(e){if(!e)return[];var t=xt(Kr(e)),n=[];return t.features.forEach(function(r){r.geometry&&(n=n.concat(Wr(r.geometry.coordinates)))}),n},ro=eo,oo=to,Dn={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},io=Object.keys(Dn);function Wt(e){for(var t=oo(),n=no(e),r=0;r<n.length;r++)t.include(n[r]);return t}Et.exports=function(e){return Wt(e).bbox()},Et.exports.polygon=function(e){return Wt(e).polygon()},Et.exports.bboxify=function(e){return ro(e).map(function(t){t&&io.some(function(n){return!!t[n]&&Dn[n].indexOf(t.type)!==-1})&&(t.bbox=Wt(t).bbox(),this.update(t))})};var ao=M(Et.exports),Ct=-90;function Qt(e,t){var n=Ct,r=90,o=Ct,i=90,s=270,m=-270;e.forEach(function(S){var C=ao(S),x=C[1],F=C[3],X=C[0],k=C[2];x>n&&(n=x),F<r&&(r=F),F>o&&(o=F),x<i&&(i=x),X<s&&(s=X),k>m&&(m=k)});var E=t;return n+E.lat>85&&(E.lat=85-n),o+E.lat>90&&(E.lat=90-o),r+E.lat<-85&&(E.lat=-85-r),i+E.lat<Ct&&(E.lat=Ct-i),s+E.lng<=-270&&(E.lng+=360*Math.ceil(Math.abs(E.lng)/360)),m+E.lng>=270&&(E.lng-=360*Math.ceil(Math.abs(E.lng)/360)),E}function en(e,t){var n=Qt(e.map(function(r){return r.toGeoJSON()}),t);e.forEach(function(r){var o,i=r.getCoordinates(),s=function(E){var S={lng:E[0]+n.lng,lat:E[1]+n.lat};return[S.lng,S.lat]},m=function(E){return E.map(function(S){return s(S)})};r.type===h.POINT?o=s(i):r.type===h.LINE_STRING||r.type===h.MULTI_POINT?o=i.map(s):r.type===h.POLYGON||r.type===h.MULTI_LINE_STRING?o=i.map(m):r.type===h.MULTI_POLYGON&&(o=i.map(function(E){return E.map(function(S){return m(S)})})),r.incomingCoords(o)})}var ne={onSetup:function(e){var t=this,n={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(n.initiallySelectedFeatureIds.filter(function(r){return t.getFeature(r)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),n},fireUpdate:function(){this.map.fire(R.UPDATE,{action:$.MOVE,features:this.getSelected().map(function(e){return e.toGeoJSON()})})},fireActionable:function(){var e=this,t=this.getSelected(),n=t.filter(function(m){return e.isInstanceOf("MultiFeature",m)}),r=!1;if(t.length>1){r=!0;var o=t[0].type.replace("Multi","");t.forEach(function(m){m.type.replace("Multi","")!==o&&(r=!1)})}var i=n.length>0,s=t.length>0;this.setActionableState({combineFeatures:r,uncombineFeatures:i,trash:s})},getUniqueIds:function(e){return e.length?e.map(function(t){return t.properties.id}).filter(function(t){return t!==void 0}).reduce(function(t,n){return t.add(n),t},new le).values():[]},stopExtendedInteractions:function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1},onStop:function(){be.enable(this)},onMouseMove:function(e,t){return Xt(t)&&e.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(e),!0},onMouseOut:function(e){return!e.dragMoving||this.fireUpdate()}};ne.onTap=ne.onClick=function(e,t){return yt(t)?this.clickAnywhere(e,t):gt(D.VERTEX)(t)?this.clickOnVertex(e,t):Xt(t)?this.clickOnFeature(e,t):void 0},ne.clickAnywhere=function(e){var t=this,n=this.getSelectedIds();n.length&&(this.clearSelectedFeatures(),n.forEach(function(r){return t.doRender(r)})),be.enable(this),this.stopExtendedInteractions(e)},ne.clickOnVertex=function(e,t){this.changeMode(w.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat}),this.updateUIClasses({mouse:f.MOVE})},ne.startOnActiveFeature=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(t.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},ne.clickOnFeature=function(e,t){var n=this;be.disable(this),this.stopExtendedInteractions(e);var r=mt(t),o=this.getSelectedIds(),i=t.featureTarget.properties.id,s=this.isSelected(i);if(!r&&s&&this.getFeature(i).type!==h.POINT)return this.changeMode(w.DIRECT_SELECT,{featureId:i});s&&r?(this.deselect(i),this.updateUIClasses({mouse:f.POINTER}),o.length===1&&be.enable(this)):!s&&r?(this.select(i),this.updateUIClasses({mouse:f.MOVE})):s||r||(o.forEach(function(m){return n.doRender(m)}),this.setSelected(i),this.updateUIClasses({mouse:f.MOVE})),this.doRender(i)},ne.onMouseDown=function(e,t){return $e(t)?this.startOnActiveFeature(e,t):this.drawConfig.boxSelect&&In(t)?this.startBoxSelect(e,t):void 0},ne.startBoxSelect=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=Kt(t.originalEvent,this.map.getContainer()),e.canBoxSelect=!0},ne.onTouchStart=function(e,t){if($e(t))return this.startOnActiveFeature(e,t)},ne.onDrag=function(e,t){return e.canDragMove?this.dragMove(e,t):this.drawConfig.boxSelect&&e.canBoxSelect?this.whileBoxSelect(e,t):void 0},ne.whileBoxSelect=function(e,t){e.boxSelecting=!0,this.updateUIClasses({mouse:f.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(y.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));var n=Kt(t.originalEvent,this.map.getContainer()),r=Math.min(e.boxSelectStartLocation.x,n.x),o=Math.max(e.boxSelectStartLocation.x,n.x),i=Math.min(e.boxSelectStartLocation.y,n.y),s=Math.max(e.boxSelectStartLocation.y,n.y),m="translate("+r+"px, "+i+"px)";e.boxSelectElement.style.transform=m,e.boxSelectElement.style.WebkitTransform=m,e.boxSelectElement.style.width=o-r+"px",e.boxSelectElement.style.height=s-i+"px"},ne.dragMove=function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();var n={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};en(this.getSelected(),n),e.dragMoveLocation=t.lngLat},ne.onTouchEnd=ne.onMouseUp=function(e,t){var n=this;if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){var r=[e.boxSelectStartLocation,Kt(t.originalEvent,this.map.getContainer())],o=this.featuresAt(null,r,"click"),i=this.getUniqueIds(o).filter(function(s){return!n.isSelected(s)});i.length&&(this.select(i),i.forEach(function(s){return n.doRender(s)}),this.updateUIClasses({mouse:f.MOVE}))}this.stopExtendedInteractions(e)},ne.toDisplayFeatures=function(e,t,n){t.properties.active=this.isSelected(t.properties.id)?V.ACTIVE:V.INACTIVE,n(t),this.fireActionable(),t.properties.active===V.ACTIVE&&t.geometry.type!==h.POINT&&_t(t).forEach(n)},ne.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},ne.onCombineFeatures=function(){var e=this.getSelected();if(!(e.length===0||e.length<2)){for(var t=[],n=[],r=e[0].type.replace("Multi",""),o=0;o<e.length;o++){var i=e[o];if(i.type.replace("Multi","")!==r)return;i.type.includes("Multi")?i.getCoordinates().forEach(function(m){t.push(m)}):t.push(i.getCoordinates()),n.push(i.toGeoJSON())}if(n.length>1){var s=this.newFeature({type:h.FEATURE,properties:n[0].properties,geometry:{type:"Multi"+r,coordinates:t}});this.addFeature(s),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([s.id]),this.map.fire(R.COMBINE_FEATURES,{createdFeatures:[s.toGeoJSON()],deletedFeatures:n})}this.fireActionable()}},ne.onUncombineFeatures=function(){var e=this,t=this.getSelected();if(t.length!==0){for(var n=[],r=[],o=function(s){var m=t[s];e.isInstanceOf("MultiFeature",m)&&(m.getFeatures().forEach(function(E){e.addFeature(E),E.properties=m.properties,n.push(E.toGeoJSON()),e.select([E.id])}),e.deleteFeature(m.id,{silent:!0}),r.push(m.toGeoJSON()))},i=0;i<t.length;i++)o(i);n.length>1&&this.map.fire(R.UNCOMBINE_FEATURES,{createdFeatures:n,deletedFeatures:r}),this.fireActionable()}};var Un=gt(D.VERTEX),Bn=gt(D.MIDPOINT),Fe={fireUpdate:function(){this.map.fire(R.UPDATE,{action:$.CHANGE_COORDINATES,features:this.getSelected().map(function(e){return e.toGeoJSON()})})},fireActionable:function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})},startDragging:function(e,t){this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},stopDragging:function(e){this.map.dragPan.enable(),e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null},onVertex:function(e,t){this.startDragging(e,t);var n=t.featureTarget.properties,r=e.selectedCoordPaths.indexOf(n.coord_path);mt(t)||r!==-1?mt(t)&&r===-1&&e.selectedCoordPaths.push(n.coord_path):e.selectedCoordPaths=[n.coord_path];var o=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(o)},onMidpoint:function(e,t){this.startDragging(e,t);var n=t.featureTarget.properties;e.feature.addCoordinate(n.coord_path,n.lng,n.lat),this.fireUpdate(),e.selectedCoordPaths=[n.coord_path]},pathsToCoordinates:function(e,t){return t.map(function(n){return{feature_id:e,coord_path:n}})},onFeature:function(e,t){e.selectedCoordPaths.length===0?this.startDragging(e,t):this.stopDragging(e)},dragFeature:function(e,t,n){en(this.getSelected(),n),e.dragMoveLocation=t.lngLat},dragVertex:function(e,t,n){for(var r=e.selectedCoordPaths.map(function(m){return e.feature.getCoordinate(m)}),o=Qt(r.map(function(m){return{type:h.FEATURE,properties:{},geometry:{type:h.POINT,coordinates:m}}}),n),i=0;i<r.length;i++){var s=r[i];e.feature.updateCoordinate(e.selectedCoordPaths[i],s[0]+o.lng,s[1]+o.lat)}},clickNoTarget:function(){this.changeMode(w.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(w.SIMPLE_SELECT)},clickActiveFeature:function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()},onSetup:function(e){var t=e.featureId,n=this.getFeature(t);if(!n)throw new Error("You must provide a featureId to enter direct_select mode");if(n.type===h.POINT)throw new TypeError("direct_select mode doesn't handle point features");var r={featureId:t,feature:n,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(t,r.selectedCoordPaths)),this.setSelected(t),be.disable(this),this.setActionableState({trash:!0}),r},onStop:function(){be.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(e,t,n){e.featureId===t.properties.id?(t.properties.active=V.ACTIVE,n(t),_t(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(n)):(t.properties.active=V.INACTIVE,n(t)),this.fireActionable(e)},onTrash:function(e){e.selectedCoordPaths.sort(function(t,n){return n.localeCompare(t,"en",{numeric:!0})}).forEach(function(t){return e.feature.removeCoordinate(t)}),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),e.feature.isValid()===!1&&(this.deleteFeature([e.featureId]),this.changeMode(w.SIMPLE_SELECT,{}))},onMouseMove:function(e,t){var n=$e(t),r=Un(t),o=Bn(t),i=e.selectedCoordPaths.length===0;return n&&i||r&&!i?this.updateUIClasses({mouse:f.MOVE}):this.updateUIClasses({mouse:f.NONE}),(r||n||o)&&e.dragMoving&&this.fireUpdate(),this.stopDragging(e),!0},onMouseOut:function(e){return e.dragMoving&&this.fireUpdate(),!0}};Fe.onTouchStart=Fe.onMouseDown=function(e,t){return Un(t)?this.onVertex(e,t):$e(t)?this.onFeature(e,t):Bn(t)?this.onMidpoint(e,t):void 0},Fe.onDrag=function(e,t){if(e.canDragMove===!0){e.dragMoving=!0,t.originalEvent.stopPropagation();var n={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,t,n):this.dragFeature(e,t,n),e.dragMoveLocation=t.lngLat}},Fe.onClick=function(e,t){return yt(t)?this.clickNoTarget(e,t):$e(t)?this.clickActiveFeature(e,t):Ht(t)?this.clickInactive(e,t):void this.stopDragging(e)},Fe.onTap=function(e,t){return yt(t)?this.clickNoTarget(e,t):$e(t)?this.clickActiveFeature(e,t):Ht(t)?this.clickInactive(e,t):void 0},Fe.onTouchEnd=Fe.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};var xe={};function Mt(e,t){return!!e.lngLat&&e.lngLat.lng===t[0]&&e.lngLat.lat===t[1]}xe.onSetup=function(){var e=this.newFeature({type:h.FEATURE,properties:{},geometry:{type:h.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:f.ADD}),this.activateUIButton(b.POINT),this.setActionableState({trash:!0}),{point:e}},xe.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(w.SIMPLE_SELECT)},xe.onTap=xe.onClick=function(e,t){this.updateUIClasses({mouse:f.MOVE}),e.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat),this.map.fire(R.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(w.SIMPLE_SELECT,{featureIds:[e.point.id]})},xe.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})},xe.toDisplayFeatures=function(e,t,n){var r=t.properties.id===e.point.id;if(t.properties.active=r?V.ACTIVE:V.INACTIVE,!r)return n(t)},xe.onTrash=xe.stopDrawingAndRemove,xe.onKeyUp=function(e,t){if(vt(t)||bt(t))return this.stopDrawingAndRemove(e,t)};var Ve={onSetup:function(){var e=this.newFeature({type:h.FEATURE,properties:{},geometry:{type:h.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),be.disable(this),this.updateUIClasses({mouse:f.ADD}),this.activateUIButton(b.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}},clickAnywhere:function(e,t){if(e.currentVertexPosition>0&&Mt(t,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(w.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:f.ADD}),e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(w.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},onMouseMove:function(e,t){e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),at(t)&&this.updateUIClasses({mouse:f.POINTER})}};Ve.onTap=Ve.onClick=function(e,t){return at(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)},Ve.onKeyUp=function(e,t){vt(t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(w.SIMPLE_SELECT)):bt(t)&&this.changeMode(w.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},Ve.onStop=function(e){this.updateUIClasses({mouse:f.NONE}),be.enable(this),this.activateUIButton(),this.getFeature(e.polygon.id)!==void 0&&(e.polygon.removeCoordinate("0."+e.currentVertexPosition),e.polygon.isValid()?this.map.fire(R.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(w.SIMPLE_SELECT,{},{silent:!0})))},Ve.toDisplayFeatures=function(e,t,n){var r=t.properties.id===e.polygon.id;if(t.properties.active=r?V.ACTIVE:V.INACTIVE,!r)return n(t);if(t.geometry.coordinates.length!==0){var o=t.geometry.coordinates[0].length;if(!(o<3)){if(t.properties.meta=D.FEATURE,n(We(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),o>3){var i=t.geometry.coordinates[0].length-3;n(We(e.polygon.id,t.geometry.coordinates[0][i],"0."+i,!1))}if(o<=4){var s=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(n({type:h.FEATURE,properties:t.properties,geometry:{coordinates:s,type:h.LINE_STRING}}),o===3)return}return n(t)}}},Ve.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(w.SIMPLE_SELECT)};var Ge={onSetup:function(e){var t,n,r=(e=e||{}).featureId,o="forward";if(r){if(!(t=this.getFeature(r)))throw new Error("Could not find a feature with the provided featureId");var i=e.from;if(i&&i.type==="Feature"&&i.geometry&&i.geometry.type==="Point"&&(i=i.geometry),i&&i.type==="Point"&&i.coordinates&&i.coordinates.length===2&&(i=i.coordinates),!i||!Array.isArray(i))throw new Error("Please use the `from` property to indicate which point to continue the line from");var s=t.coordinates.length-1;if(t.coordinates[s][0]===i[0]&&t.coordinates[s][1]===i[1])n=s+1,t.addCoordinate.apply(t,[n].concat(t.coordinates[s]));else{if(t.coordinates[0][0]!==i[0]||t.coordinates[0][1]!==i[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");o="backwards",n=0,t.addCoordinate.apply(t,[n].concat(t.coordinates[0]))}}else t=this.newFeature({type:h.FEATURE,properties:{},geometry:{type:h.LINE_STRING,coordinates:[]}}),n=0,this.addFeature(t);return this.clearSelectedFeatures(),be.disable(this),this.updateUIClasses({mouse:f.ADD}),this.activateUIButton(b.LINE),this.setActionableState({trash:!0}),{line:t,currentVertexPosition:n,direction:o}},clickAnywhere:function(e,t){if(e.currentVertexPosition>0&&Mt(t,e.line.coordinates[e.currentVertexPosition-1])||e.direction==="backwards"&&Mt(t,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(w.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:f.ADD}),e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.direction==="forward"?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(w.SIMPLE_SELECT,{featureIds:[e.line.id]})},onMouseMove:function(e,t){e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),at(t)&&this.updateUIClasses({mouse:f.POINTER})}};Ge.onTap=Ge.onClick=function(e,t){if(at(t))return this.clickOnVertex(e,t);this.clickAnywhere(e,t)},Ge.onKeyUp=function(e,t){bt(t)?this.changeMode(w.SIMPLE_SELECT,{featureIds:[e.line.id]}):vt(t)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(w.SIMPLE_SELECT))},Ge.onStop=function(e){be.enable(this),this.activateUIButton(),this.getFeature(e.line.id)!==void 0&&(e.line.removeCoordinate(""+e.currentVertexPosition),e.line.isValid()?this.map.fire(R.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(w.SIMPLE_SELECT,{},{silent:!0})))},Ge.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(w.SIMPLE_SELECT)},Ge.toDisplayFeatures=function(e,t,n){var r=t.properties.id===e.line.id;if(t.properties.active=r?V.ACTIVE:V.INACTIVE,!r)return n(t);t.geometry.coordinates.length<2||(t.properties.meta=D.FEATURE,n(We(e.line.id,t.geometry.coordinates[e.direction==="forward"?t.geometry.coordinates.length-2:1],""+(e.direction==="forward"?t.geometry.coordinates.length-2:1),!1)),n(t))};var jn={simple_select:ne,direct_select:Fe,draw_point:xe,draw_polygon:Ve,draw_line_string:Ge},so={defaultMode:w.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Pn,modes:jn,controls:{},userProperties:!1},lo={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},co={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function $n(e,t){return e.map(function(n){return n.source?n:Ne(n,{id:n.id+"."+t,source:t==="hot"?v.HOT:v.COLD})})}var tn={exports:{}};(function(e,t){var n="__lodash_hash_undefined__",r=9007199254740991,o="[object Arguments]",i="[object Array]",s="[object Boolean]",m="[object Date]",E="[object Error]",S="[object Function]",C="[object Map]",x="[object Number]",F="[object Object]",X="[object Promise]",k="[object RegExp]",W="[object Set]",g="[object String]",O="[object Symbol]",G="[object WeakMap]",ae="[object ArrayBuffer]",Q="[object DataView]",nn=/^\[object .+?Constructor\]$/,ho=/^(?:0|[1-9]\d*)$/,Z={};Z["[object Float32Array]"]=Z["[object Float64Array]"]=Z["[object Int8Array]"]=Z["[object Int16Array]"]=Z["[object Int32Array]"]=Z["[object Uint8Array]"]=Z["[object Uint8ClampedArray]"]=Z["[object Uint16Array]"]=Z["[object Uint32Array]"]=!0,Z[o]=Z[i]=Z[ae]=Z[s]=Z[Q]=Z[m]=Z[E]=Z[S]=Z[C]=Z[x]=Z[F]=Z[k]=Z[W]=Z[g]=Z[G]=!1;var zn=typeof He=="object"&&He&&He.Object===Object&&He,go=typeof self=="object"&&self&&self.Object===Object&&self,Me=zn||go||Function("return this")(),Jn=t&&!t.nodeType&&t,Yn=Jn&&e&&!e.nodeType&&e,qn=Yn&&Yn.exports===Jn,rn=qn&&zn.process,Zn=function(){try{return rn&&rn.binding&&rn.binding("util")}catch{}}(),Hn=Zn&&Zn.isTypedArray;function yo(l,d){for(var T=-1,I=l==null?0:l.length;++T<I;)if(d(l[T],T,l))return!0;return!1}function mo(l){var d=-1,T=Array(l.size);return l.forEach(function(I,H){T[++d]=[H,I]}),T}function vo(l){var d=-1,T=Array(l.size);return l.forEach(function(I){T[++d]=I}),T}var Xn,Kn,Wn,bo=Array.prototype,_o=Function.prototype,Pt=Object.prototype,on=Me["__core-js_shared__"],Qn=_o.toString,we=Pt.hasOwnProperty,er=(Xn=/[^.]+$/.exec(on&&on.keys&&on.keys.IE_PROTO||""))?"Symbol(src)_1."+Xn:"",tr=Pt.toString,Eo=RegExp("^"+Qn.call(we).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),nr=qn?Me.Buffer:void 0,It=Me.Symbol,rr=Me.Uint8Array,or=Pt.propertyIsEnumerable,xo=bo.splice,ze=It?It.toStringTag:void 0,ir=Object.getOwnPropertySymbols,wo=nr?nr.isBuffer:void 0,To=(Kn=Object.keys,Wn=Object,function(l){return Kn(Wn(l))}),an=et(Me,"DataView"),st=et(Me,"Map"),sn=et(Me,"Promise"),ln=et(Me,"Set"),cn=et(Me,"WeakMap"),lt=et(Object,"create"),So=qe(an),Co=qe(st),Mo=qe(sn),Oo=qe(ln),Po=qe(cn),ar=It?It.prototype:void 0,un=ar?ar.valueOf:void 0;function Je(l){var d=-1,T=l==null?0:l.length;for(this.clear();++d<T;){var I=l[d];this.set(I[0],I[1])}}function Oe(l){var d=-1,T=l==null?0:l.length;for(this.clear();++d<T;){var I=l[d];this.set(I[0],I[1])}}function Ye(l){var d=-1,T=l==null?0:l.length;for(this.clear();++d<T;){var I=l[d];this.set(I[0],I[1])}}function Lt(l){var d=-1,T=l==null?0:l.length;for(this.__data__=new Ye;++d<T;)this.add(l[d])}function Ae(l){var d=this.__data__=new Oe(l);this.size=d.size}function Io(l,d){var T=At(l),I=!T&&ko(l),H=!T&&!I&&fn(l),j=!T&&!I&&!H&&gr(l),K=T||I||H||j,ee=K?function(oe,Te){for(var Pe=-1,fe=Array(oe);++Pe<oe;)fe[Pe]=Te(Pe);return fe}(l.length,String):[],_e=ee.length;for(var re in l)!d&&!we.call(l,re)||K&&(re=="length"||H&&(re=="offset"||re=="parent")||j&&(re=="buffer"||re=="byteLength"||re=="byteOffset")||Ao(re,_e))||ee.push(re);return ee}function Nt(l,d){for(var T=l.length;T--;)if(fr(l[T][0],d))return T;return-1}function ct(l){return l==null?l===void 0?"[object Undefined]":"[object Null]":ze&&ze in Object(l)?function(d){var T=we.call(d,ze),I=d[ze];try{d[ze]=void 0;var H=!0}catch{}var j=tr.call(d);return H&&(T?d[ze]=I:delete d[ze]),j}(l):function(d){return tr.call(d)}(l)}function sr(l){return ut(l)&&ct(l)==o}function lr(l,d,T,I,H){return l===d||(l==null||d==null||!ut(l)&&!ut(d)?l!=l&&d!=d:function(j,K,ee,_e,re,oe){var Te=At(j),Pe=At(K),fe=Te?i:ke(j),Ie=Pe?i:ke(K),tt=(fe=fe==o?F:fe)==F,kt=(Ie=Ie==o?F:Ie)==F,nt=fe==Ie;if(nt&&fn(j)){if(!fn(K))return!1;Te=!0,tt=!1}if(nt&&!tt)return oe||(oe=new Ae),Te||gr(j)?cr(j,K,ee,_e,re,oe):function(J,z,Rt,Re,dn,ye,Le){switch(Rt){case Q:if(J.byteLength!=z.byteLength||J.byteOffset!=z.byteOffset)return!1;J=J.buffer,z=z.buffer;case ae:return!(J.byteLength!=z.byteLength||!ye(new rr(J),new rr(z)));case s:case m:case x:return fr(+J,+z);case E:return J.name==z.name&&J.message==z.message;case k:case g:return J==z+"";case C:var De=mo;case W:var dt=1&Re;if(De||(De=vo),J.size!=z.size&&!dt)return!1;var Dt=Le.get(J);if(Dt)return Dt==z;Re|=2,Le.set(J,z);var rt=cr(De(J),De(z),Re,dn,ye,Le);return Le.delete(J),rt;case O:if(un)return un.call(J)==un.call(z)}return!1}(j,K,fe,ee,_e,re,oe);if(!(1&ee)){var ft=tt&&we.call(j,"__wrapped__"),yr=kt&&we.call(K,"__wrapped__");if(ft||yr){var Do=ft?j.value():j,Uo=yr?K.value():K;return oe||(oe=new Ae),re(Do,Uo,ee,_e,oe)}}return nt?(oe||(oe=new Ae),function(J,z,Rt,Re,dn,ye){var Le=1&Rt,De=ur(J),dt=De.length,Dt=ur(z).length;if(dt!=Dt&&!Le)return!1;for(var rt=dt;rt--;){var Ze=De[rt];if(!(Le?Ze in z:we.call(z,Ze)))return!1}var mr=ye.get(J);if(mr&&ye.get(z))return mr==z;var Ut=!0;ye.set(J,z),ye.set(z,J);for(var pn=Le;++rt<dt;){var Bt=J[Ze=De[rt]],jt=z[Ze];if(Re)var vr=Le?Re(jt,Bt,Ze,z,J,ye):Re(Bt,jt,Ze,J,z,ye);if(!(vr===void 0?Bt===jt||dn(Bt,jt,Rt,Re,ye):vr)){Ut=!1;break}pn||(pn=Ze=="constructor")}if(Ut&&!pn){var $t=J.constructor,Vt=z.constructor;$t==Vt||!("constructor"in J)||!("constructor"in z)||typeof $t=="function"&&$t instanceof $t&&typeof Vt=="function"&&Vt instanceof Vt||(Ut=!1)}return ye.delete(J),ye.delete(z),Ut}(j,K,ee,_e,re,oe)):!1}(l,d,T,I,lr,H))}function Lo(l){return!(!hr(l)||function(d){return!!er&&er in d}(l))&&(dr(l)?Eo:nn).test(qe(l))}function No(l){if(T=(d=l)&&d.constructor,I=typeof T=="function"&&T.prototype||Pt,d!==I)return To(l);var d,T,I,H=[];for(var j in Object(l))we.call(l,j)&&j!="constructor"&&H.push(j);return H}function cr(l,d,T,I,H,j){var K=1&T,ee=l.length,_e=d.length;if(ee!=_e&&!(K&&_e>ee))return!1;var re=j.get(l);if(re&&j.get(d))return re==d;var oe=-1,Te=!0,Pe=2&T?new Lt:void 0;for(j.set(l,d),j.set(d,l);++oe<ee;){var fe=l[oe],Ie=d[oe];if(I)var tt=K?I(Ie,fe,oe,d,l,j):I(fe,Ie,oe,l,d,j);if(tt!==void 0){if(tt)continue;Te=!1;break}if(Pe){if(!yo(d,function(kt,nt){if(ft=nt,!Pe.has(ft)&&(fe===kt||H(fe,kt,T,I,j)))return Pe.push(nt);var ft})){Te=!1;break}}else if(fe!==Ie&&!H(fe,Ie,T,I,j)){Te=!1;break}}return j.delete(l),j.delete(d),Te}function ur(l){return function(d,T,I){var H=T(d);return At(d)?H:function(j,K){for(var ee=-1,_e=K.length,re=j.length;++ee<_e;)j[re+ee]=K[ee];return j}(H,I(d))}(l,Ro,Fo)}function Ft(l,d){var T,I,H=l.__data__;return((I=typeof(T=d))=="string"||I=="number"||I=="symbol"||I=="boolean"?T!=="__proto__":T===null)?H[typeof d=="string"?"string":"hash"]:H.map}function et(l,d){var T=function(I,H){return I==null?void 0:I[H]}(l,d);return Lo(T)?T:void 0}Je.prototype.clear=function(){this.__data__=lt?lt(null):{},this.size=0},Je.prototype.delete=function(l){var d=this.has(l)&&delete this.__data__[l];return this.size-=d?1:0,d},Je.prototype.get=function(l){var d=this.__data__;if(lt){var T=d[l];return T===n?void 0:T}return we.call(d,l)?d[l]:void 0},Je.prototype.has=function(l){var d=this.__data__;return lt?d[l]!==void 0:we.call(d,l)},Je.prototype.set=function(l,d){var T=this.__data__;return this.size+=this.has(l)?0:1,T[l]=lt&&d===void 0?n:d,this},Oe.prototype.clear=function(){this.__data__=[],this.size=0},Oe.prototype.delete=function(l){var d=this.__data__,T=Nt(d,l);return!(T<0)&&(T==d.length-1?d.pop():xo.call(d,T,1),--this.size,!0)},Oe.prototype.get=function(l){var d=this.__data__,T=Nt(d,l);return T<0?void 0:d[T][1]},Oe.prototype.has=function(l){return Nt(this.__data__,l)>-1},Oe.prototype.set=function(l,d){var T=this.__data__,I=Nt(T,l);return I<0?(++this.size,T.push([l,d])):T[I][1]=d,this},Ye.prototype.clear=function(){this.size=0,this.__data__={hash:new Je,map:new(st||Oe),string:new Je}},Ye.prototype.delete=function(l){var d=Ft(this,l).delete(l);return this.size-=d?1:0,d},Ye.prototype.get=function(l){return Ft(this,l).get(l)},Ye.prototype.has=function(l){return Ft(this,l).has(l)},Ye.prototype.set=function(l,d){var T=Ft(this,l),I=T.size;return T.set(l,d),this.size+=T.size==I?0:1,this},Lt.prototype.add=Lt.prototype.push=function(l){return this.__data__.set(l,n),this},Lt.prototype.has=function(l){return this.__data__.has(l)},Ae.prototype.clear=function(){this.__data__=new Oe,this.size=0},Ae.prototype.delete=function(l){var d=this.__data__,T=d.delete(l);return this.size=d.size,T},Ae.prototype.get=function(l){return this.__data__.get(l)},Ae.prototype.has=function(l){return this.__data__.has(l)},Ae.prototype.set=function(l,d){var T=this.__data__;if(T instanceof Oe){var I=T.__data__;if(!st||I.length<199)return I.push([l,d]),this.size=++T.size,this;T=this.__data__=new Ye(I)}return T.set(l,d),this.size=T.size,this};var Fo=ir?function(l){return l==null?[]:(l=Object(l),function(d,T){for(var I=-1,H=d==null?0:d.length,j=0,K=[];++I<H;){var ee=d[I];T(ee,I,d)&&(K[j++]=ee)}return K}(ir(l),function(d){return or.call(l,d)}))}:function(){return[]},ke=ct;function Ao(l,d){return!!(d=d??r)&&(typeof l=="number"||ho.test(l))&&l>-1&&l%1==0&&l<d}function qe(l){if(l!=null){try{return Qn.call(l)}catch{}try{return l+""}catch{}}return""}function fr(l,d){return l===d||l!=l&&d!=d}(an&&ke(new an(new ArrayBuffer(1)))!=Q||st&&ke(new st)!=C||sn&&ke(sn.resolve())!=X||ln&&ke(new ln)!=W||cn&&ke(new cn)!=G)&&(ke=function(l){var d=ct(l),T=d==F?l.constructor:void 0,I=T?qe(T):"";if(I)switch(I){case So:return Q;case Co:return C;case Mo:return X;case Oo:return W;case Po:return G}return d});var ko=sr(function(){return arguments}())?sr:function(l){return ut(l)&&we.call(l,"callee")&&!or.call(l,"callee")},At=Array.isArray,fn=wo||function(){return!1};function dr(l){if(!hr(l))return!1;var d=ct(l);return d==S||d=="[object GeneratorFunction]"||d=="[object AsyncFunction]"||d=="[object Proxy]"}function pr(l){return typeof l=="number"&&l>-1&&l%1==0&&l<=r}function hr(l){var d=typeof l;return l!=null&&(d=="object"||d=="function")}function ut(l){return l!=null&&typeof l=="object"}var gr=Hn?function(l){return function(d){return l(d)}}(Hn):function(l){return ut(l)&&pr(l.length)&&!!Z[ct(l)]};function Ro(l){return(d=l)!=null&&pr(d.length)&&!dr(d)?Io(l):No(l);var d}e.exports=function(l,d){return lr(l,d)}})(tn,tn.exports);var Vn=M(tn.exports);function Gn(e,t){return e.length===t.length&&JSON.stringify(e.map(function(n){return n}).sort())===JSON.stringify(t.map(function(n){return n}).sort())}var uo={Polygon:he,LineString:Ce,Point:je,MultiPolygon:pe,MultiLineString:pe,MultiPoint:pe},fo=Object.freeze({__proto__:null,CommonSelectors:Jr,constrainFeatureMovement:Qt,createMidPoint:Ln,createSupplementaryPoints:_t,createVertex:We,doubleClickZoom:be,euclideanDistance:zt,featuresAt:Se,getFeatureAtAndSetCursors:pt,isClick:Jt,isEventAtCoordinates:Mt,isTap:Yt,mapEventToBoundingBox:Xe,ModeHandler:_,moveFeatures:en,sortFeatures:de,stringSetsAreEqual:Gn,StringSet:le,theme:Pn,toDenseArray:it}),po=function(e,t){var n={options:e=function(o){o===void 0&&(o={});var i=Ne(o);return o.controls||(i.controls={}),o.displayControlsDefault===!1?i.controls=Ne(co,o.controls):i.controls=Ne(lo,o.controls),(i=Ne(so,i)).styles=$n(i.styles,"cold").concat($n(i.styles,"hot")),i}(e)};t=function(o,i){return i.modes=w,i.getFeatureIdsAt=function(s){return Se.click({point:s},null,o).map(function(m){return m.properties.id})},i.getSelectedIds=function(){return o.store.getSelectedIds()},i.getSelected=function(){return{type:h.FEATURE_COLLECTION,features:o.store.getSelectedIds().map(function(s){return o.store.get(s)}).map(function(s){return s.toGeoJSON()})}},i.getSelectedPoints=function(){return{type:h.FEATURE_COLLECTION,features:o.store.getSelectedCoordinates().map(function(s){return{type:h.FEATURE,properties:{},geometry:{type:h.POINT,coordinates:s.coordinates}}})}},i.set=function(s){if(s.type===void 0||s.type!==h.FEATURE_COLLECTION||!Array.isArray(s.features))throw new Error("Invalid FeatureCollection");var m=o.store.createRenderBatch(),E=o.store.getAllIds().slice(),S=i.add(s),C=new le(S);return(E=E.filter(function(x){return!C.has(x)})).length&&i.delete(E),m(),S},i.add=function(s){var m=JSON.parse(JSON.stringify(Hr(s))).features.map(function(E){if(E.id=E.id||Zt(),E.geometry===null)throw new Error("Invalid geometry: null");if(o.store.get(E.id)===void 0||o.store.get(E.id).type!==E.geometry.type){var S=uo[E.geometry.type];if(S===void 0)throw new Error("Invalid geometry type: "+E.geometry.type+".");var C=new S(o,E);o.store.add(C)}else{var x=o.store.get(E.id);x.properties=E.properties,Vn(x.properties,E.properties)||o.store.featureChanged(x.id),Vn(x.getCoordinates(),E.geometry.coordinates)||x.incomingCoords(E.geometry.coordinates)}return E.id});return o.store.render(),m},i.get=function(s){var m=o.store.get(s);if(m)return m.toGeoJSON()},i.getAll=function(){return{type:h.FEATURE_COLLECTION,features:o.store.getAll().map(function(s){return s.toGeoJSON()})}},i.delete=function(s){return o.store.delete(s,{silent:!0}),i.getMode()!==w.DIRECT_SELECT||o.store.getSelectedIds().length?o.store.render():o.events.changeMode(w.SIMPLE_SELECT,void 0,{silent:!0}),i},i.deleteAll=function(){return o.store.delete(o.store.getAllIds(),{silent:!0}),i.getMode()===w.DIRECT_SELECT?o.events.changeMode(w.SIMPLE_SELECT,void 0,{silent:!0}):o.store.render(),i},i.changeMode=function(s,m){return m===void 0&&(m={}),s===w.SIMPLE_SELECT&&i.getMode()===w.SIMPLE_SELECT?(Gn(m.featureIds||[],o.store.getSelectedIds())||(o.store.setSelected(m.featureIds,{silent:!0}),o.store.render()),i):(s===w.DIRECT_SELECT&&i.getMode()===w.DIRECT_SELECT&&m.featureId===o.store.getSelectedIds()[0]||o.events.changeMode(s,m,{silent:!0}),i)},i.getMode=function(){return o.events.getMode()},i.trash=function(){return o.events.trash({silent:!0}),i},i.combineFeatures=function(){return o.events.combineFeatures({silent:!0}),i},i.uncombineFeatures=function(){return o.events.uncombineFeatures({silent:!0}),i},i.setFeatureProperty=function(s,m,E){return o.store.setFeatureProperty(s,m,E),i},i}(n,t),n.api=t;var r=zr(n);return t.onAdd=r.onAdd,t.onRemove=r.onRemove,t.types=b,t.options=e,t};function Ot(e){po(e,this)}return Ot.modes=jn,Ot.constants=se,Ot.lib=fo,Ot})})(vn);var Cr=vn.exports;const bn=mn(Cr);function Mr(p,c,_){_===void 0&&(_={});var M=Gt(p),L=Gt(c),N=Be(L[1]-M[1]),A=Be(L[0]-M[0]),P=Be(M[1]),U=Be(L[1]),a=Math.pow(Math.sin(N/2),2)+Math.pow(Math.sin(A/2),2)*Math.cos(P)*Math.cos(U);return xr(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),_.units)}function _n(p,c,_){if(p!==null)for(var M,L,N,A,P,U,a,u=0,y=0,v,f=p.type,b=f==="FeatureCollection",h=f==="Feature",w=b?p.features.length:1,R=0;R<w;R++){a=b?p.features[R].geometry:h?p.geometry:p,v=a?a.type==="GeometryCollection":!1,P=v?a.geometries.length:1;for(var $=0;$<P;$++){var D=0,V=0;if(A=v?a.geometries[$]:a,A!==null){U=A.coordinates;var Y=A.type;switch(u=_&&(Y==="Polygon"||Y==="MultiPolygon")?1:0,Y){case null:break;case"Point":if(c(U,y,R,D,V)===!1)return!1;y++,D++;break;case"LineString":case"MultiPoint":for(M=0;M<U.length;M++){if(c(U[M],y,R,D,V)===!1)return!1;y++,Y==="MultiPoint"&&D++}Y==="LineString"&&D++;break;case"Polygon":case"MultiLineString":for(M=0;M<U.length;M++){for(L=0;L<U[M].length-u;L++){if(c(U[M][L],y,R,D,V)===!1)return!1;y++}Y==="MultiLineString"&&D++,Y==="Polygon"&&V++}Y==="Polygon"&&D++;break;case"MultiPolygon":for(M=0;M<U.length;M++){for(V=0,L=0;L<U[M].length;L++){for(N=0;N<U[M][L].length-u;N++){if(c(U[M][L][N],y,R,D,V)===!1)return!1;y++}V++}D++}break;case"GeometryCollection":for(M=0;M<A.geometries.length;M++)if(_n(A.geometries[M],c,_)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Or(p,c){var _,M,L,N,A,P,U,a,u,y,v=0,f=p.type==="FeatureCollection",b=p.type==="Feature",h=f?p.features.length:1;for(_=0;_<h;_++){for(P=f?p.features[_].geometry:b?p.geometry:p,a=f?p.features[_].properties:b?p.properties:{},u=f?p.features[_].bbox:b?p.bbox:void 0,y=f?p.features[_].id:b?p.id:void 0,U=P?P.type==="GeometryCollection":!1,A=U?P.geometries.length:1,L=0;L<A;L++){if(N=U?P.geometries[L]:P,N===null){if(c(null,v,a,u,y)===!1)return!1;continue}switch(N.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(c(N,v,a,u,y)===!1)return!1;break}case"GeometryCollection":{for(M=0;M<N.geometries.length;M++)if(c(N.geometries[M],v,a,u,y)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}v++}}function Pr(p,c){Or(p,function(_,M,L,N,A){var P=_===null?null:_.type;switch(P){case null:case"Point":case"LineString":case"Polygon":return c(ot(_,L,{bbox:N,id:A}),M,0)===!1?!1:void 0}var U;switch(P){case"MultiPoint":U="Point";break;case"MultiLineString":U="LineString";break;case"MultiPolygon":U="Polygon";break}for(var a=0;a<_.coordinates.length;a++){var u=_.coordinates[a],y={type:U,coordinates:u};if(c(ot(y,L),M,a)===!1)return!1}})}function Ir(p,c){Pr(p,function(_,M,L){var N=0;if(_.geometry){var A=_.geometry.type;if(!(A==="Point"||A==="MultiPoint")){var P,U=0,a=0,u=0;if(_n(_,function(y,v,f,b,h){if(P===void 0||M>U||b>a||h>u){P=y,U=M,a=b,u=h,N=0;return}var w=Er([P,y],_.properties);if(c(w,M,L,h,N)===!1)return!1;N++,P=y})===!1)return!1}}})}function Lr(p,c,_){var M=_,L=!1;return Ir(p,function(N,A,P,U,a){L===!1&&_===void 0?M=N:M=c(M,N,A,P,U,a),L=!0}),M}function En(p,c){return c===void 0&&(c={}),Lr(p,function(_,M){var L=M.geometry.coordinates;return _+Mr(L[0],L[1],c)},0)}var xn={exports:{}};/*! @preserve
 * numeral.js
 * version : 2.0.6
 * author : Adam Draper
 * license : MIT
 * http://adamwdraper.github.com/Numeral-js/
 */(function(p){(function(c,_){p.exports?p.exports=_():c.numeral=_()})(He,function(){var c,_,M="2.0.6",L={},N={},A={currentLocale:"en",zeroFormat:null,nullFormat:null,defaultFormat:"0,0",scalePercentBy100:!0},P={currentLocale:A.currentLocale,zeroFormat:A.zeroFormat,nullFormat:A.nullFormat,defaultFormat:A.defaultFormat,scalePercentBy100:A.scalePercentBy100};function U(a,u){this._input=a,this._value=u}return c=function(a){var u,y,v,f;if(c.isNumeral(a))u=a.value();else if(a===0||typeof a>"u")u=0;else if(a===null||_.isNaN(a))u=null;else if(typeof a=="string")if(P.zeroFormat&&a===P.zeroFormat)u=0;else if(P.nullFormat&&a===P.nullFormat||!a.replace(/[^0-9]+/g,"").length)u=null;else{for(y in L)if(f=typeof L[y].regexps.unformat=="function"?L[y].regexps.unformat():L[y].regexps.unformat,f&&a.match(f)){v=L[y].unformat;break}v=v||c._.stringToNumber,u=v(a)}else u=Number(a)||null;return new U(a,u)},c.version=M,c.isNumeral=function(a){return a instanceof U},c._=_={numberToFormat:function(a,u,y){var v=N[c.options.currentLocale],f=!1,b=!1,h=0,w="",R=1e12,$=1e9,D=1e6,V=1e3,Y="",Ee=!1,se,me,te,de,Xe,le,ve;if(a=a||0,me=Math.abs(a),c._.includes(u,"(")?(f=!0,u=u.replace(/[\(|\)]/g,"")):(c._.includes(u,"+")||c._.includes(u,"-"))&&(Xe=c._.includes(u,"+")?u.indexOf("+"):a<0?u.indexOf("-"):-1,u=u.replace(/[\+|\-]/g,"")),c._.includes(u,"a")&&(se=u.match(/a(k|m|b|t)?/),se=se?se[1]:!1,c._.includes(u," a")&&(w=" "),u=u.replace(new RegExp(w+"a[kmbt]?"),""),me>=R&&!se||se==="t"?(w+=v.abbreviations.trillion,a=a/R):me<R&&me>=$&&!se||se==="b"?(w+=v.abbreviations.billion,a=a/$):me<$&&me>=D&&!se||se==="m"?(w+=v.abbreviations.million,a=a/D):(me<D&&me>=V&&!se||se==="k")&&(w+=v.abbreviations.thousand,a=a/V)),c._.includes(u,"[.]")&&(b=!0,u=u.replace("[.]",".")),te=a.toString().split(".")[0],de=u.split(".")[1],le=u.indexOf(","),h=(u.split(".")[0].split(",")[0].match(/0/g)||[]).length,de?(c._.includes(de,"[")?(de=de.replace("]",""),de=de.split("["),Y=c._.toFixed(a,de[0].length+de[1].length,y,de[1].length)):Y=c._.toFixed(a,de.length,y),te=Y.split(".")[0],c._.includes(Y,".")?Y=v.delimiters.decimal+Y.split(".")[1]:Y="",b&&Number(Y.slice(1))===0&&(Y="")):te=c._.toFixed(a,0,y),w&&!se&&Number(te)>=1e3&&w!==v.abbreviations.trillion)switch(te=String(Number(te)/1e3),w){case v.abbreviations.thousand:w=v.abbreviations.million;break;case v.abbreviations.million:w=v.abbreviations.billion;break;case v.abbreviations.billion:w=v.abbreviations.trillion;break}if(c._.includes(te,"-")&&(te=te.slice(1),Ee=!0),te.length<h)for(var Se=h-te.length;Se>0;Se--)te="0"+te;return le>-1&&(te=te.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+v.delimiters.thousands)),u.indexOf(".")===0&&(te=""),ve=te+Y+(w||""),f?ve=(f&&Ee?"(":"")+ve+(f&&Ee?")":""):Xe>=0?ve=Xe===0?(Ee?"-":"+")+ve:ve+(Ee?"-":"+"):Ee&&(ve="-"+ve),ve},stringToNumber:function(a){var u=N[P.currentLocale],y=a,v={thousand:3,million:6,billion:9,trillion:12},f,b,h;if(P.zeroFormat&&a===P.zeroFormat)b=0;else if(P.nullFormat&&a===P.nullFormat||!a.replace(/[^0-9]+/g,"").length)b=null;else{b=1,u.delimiters.decimal!=="."&&(a=a.replace(/\./g,"").replace(u.delimiters.decimal,"."));for(f in v)if(h=new RegExp("[^a-zA-Z]"+u.abbreviations[f]+"(?:\\)|(\\"+u.currency.symbol+")?(?:\\))?)?$"),y.match(h)){b*=Math.pow(10,v[f]);break}b*=(a.split("-").length+Math.min(a.split("(").length-1,a.split(")").length-1))%2?1:-1,a=a.replace(/[^0-9\.]+/g,""),b*=Number(a)}return b},isNaN:function(a){return typeof a=="number"&&isNaN(a)},includes:function(a,u){return a.indexOf(u)!==-1},insert:function(a,u,y){return a.slice(0,y)+u+a.slice(y)},reduce:function(a,u){if(this===null)throw new TypeError("Array.prototype.reduce called on null or undefined");if(typeof u!="function")throw new TypeError(u+" is not a function");var y=Object(a),v=y.length>>>0,f=0,b;if(arguments.length===3)b=arguments[2];else{for(;f<v&&!(f in y);)f++;if(f>=v)throw new TypeError("Reduce of empty array with no initial value");b=y[f++]}for(;f<v;f++)f in y&&(b=u(b,y[f],f,y));return b},multiplier:function(a){var u=a.toString().split(".");return u.length<2?1:Math.pow(10,u[1].length)},correctionFactor:function(){var a=Array.prototype.slice.call(arguments);return a.reduce(function(u,y){var v=_.multiplier(y);return u>v?u:v},1)},toFixed:function(a,u,y,v){var f=a.toString().split("."),b=u-(v||0),h,w,R,$;return f.length===2?h=Math.min(Math.max(f[1].length,b),u):h=b,R=Math.pow(10,h),$=(y(a+"e+"+h)/R).toFixed(h),v>u-h&&(w=new RegExp("\\.?0{1,"+(v-(u-h))+"}$"),$=$.replace(w,"")),$}},c.options=P,c.formats=L,c.locales=N,c.locale=function(a){return a&&(P.currentLocale=a.toLowerCase()),P.currentLocale},c.localeData=function(a){if(!a)return N[P.currentLocale];if(a=a.toLowerCase(),!N[a])throw new Error("Unknown locale : "+a);return N[a]},c.reset=function(){for(var a in A)P[a]=A[a]},c.zeroFormat=function(a){P.zeroFormat=typeof a=="string"?a:null},c.nullFormat=function(a){P.nullFormat=typeof a=="string"?a:null},c.defaultFormat=function(a){P.defaultFormat=typeof a=="string"?a:"0.0"},c.register=function(a,u,y){if(u=u.toLowerCase(),this[a+"s"][u])throw new TypeError(u+" "+a+" already registered.");return this[a+"s"][u]=y,y},c.validate=function(a,u){var y,v,f,b,h,w,R,$;if(typeof a!="string"&&(a+="",console.warn&&console.warn("Numeral.js: Value is not string. It has been co-erced to: ",a)),a=a.trim(),a.match(/^\d+$/))return!0;if(a==="")return!1;try{R=c.localeData(u)}catch{R=c.localeData(c.locale())}return f=R.currency.symbol,h=R.abbreviations,y=R.delimiters.decimal,R.delimiters.thousands==="."?v="\\.":v=R.delimiters.thousands,$=a.match(/^[^\d]+/),$!==null&&(a=a.substr(1),$[0]!==f)||($=a.match(/[^\d]+$/),$!==null&&(a=a.slice(0,-1),$[0]!==h.thousand&&$[0]!==h.million&&$[0]!==h.billion&&$[0]!==h.trillion))?!1:(w=new RegExp(v+"{2}"),a.match(/[^\d.,]/g)?!1:(b=a.split(y),b.length>2?!1:b.length<2?!!b[0].match(/^\d+.*\d$/)&&!b[0].match(w):b[0].length===1?!!b[0].match(/^\d+$/)&&!b[0].match(w)&&!!b[1].match(/^\d+$/):!!b[0].match(/^\d+.*\d$/)&&!b[0].match(w)&&!!b[1].match(/^\d+$/)))},c.fn=U.prototype={clone:function(){return c(this)},format:function(a,u){var y=this._value,v=a||P.defaultFormat,f,b,h;if(u=u||Math.round,y===0&&P.zeroFormat!==null)b=P.zeroFormat;else if(y===null&&P.nullFormat!==null)b=P.nullFormat;else{for(f in L)if(v.match(L[f].regexps.format)){h=L[f].format;break}h=h||c._.numberToFormat,b=h(y,v,u)}return b},value:function(){return this._value},input:function(){return this._input},set:function(a){return this._value=Number(a),this},add:function(a){var u=_.correctionFactor.call(null,this._value,a);function y(v,f,b,h){return v+Math.round(u*f)}return this._value=_.reduce([this._value,a],y,0)/u,this},subtract:function(a){var u=_.correctionFactor.call(null,this._value,a);function y(v,f,b,h){return v-Math.round(u*f)}return this._value=_.reduce([a],y,Math.round(this._value*u))/u,this},multiply:function(a){function u(y,v,f,b){var h=_.correctionFactor(y,v);return Math.round(y*h)*Math.round(v*h)/Math.round(h*h)}return this._value=_.reduce([this._value,a],u,1),this},divide:function(a){function u(y,v,f,b){var h=_.correctionFactor(y,v);return Math.round(y*h)/Math.round(v*h)}return this._value=_.reduce([this._value,a],u),this},difference:function(a){return Math.abs(c(this._value).subtract(a).value())}},c.register("locale","en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(a){var u=a%10;return~~(a%100/10)===1?"th":u===1?"st":u===2?"nd":u===3?"rd":"th"},currency:{symbol:"$"}}),function(){c.register("format","bps",{regexps:{format:/(BPS)/,unformat:/(BPS)/},format:function(a,u,y){var v=c._.includes(u," BPS")?" ":"",f;return a=a*1e4,u=u.replace(/\s?BPS/,""),f=c._.numberToFormat(a,u,y),c._.includes(f,")")?(f=f.split(""),f.splice(-1,0,v+"BPS"),f=f.join("")):f=f+v+"BPS",f},unformat:function(a){return+(c._.stringToNumber(a)*1e-4).toFixed(15)}})}(),function(){var a={base:1e3,suffixes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]},u={base:1024,suffixes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},y=a.suffixes.concat(u.suffixes.filter(function(f){return a.suffixes.indexOf(f)<0})),v=y.join("|");v="("+v.replace("B","B(?!PS)")+")",c.register("format","bytes",{regexps:{format:/([0\s]i?b)/,unformat:new RegExp(v)},format:function(f,b,h){var w,R=c._.includes(b,"ib")?u:a,$=c._.includes(b," b")||c._.includes(b," ib")?" ":"",D,V,Y;for(b=b.replace(/\s?i?b/,""),D=0;D<=R.suffixes.length;D++)if(V=Math.pow(R.base,D),Y=Math.pow(R.base,D+1),f===null||f===0||f>=V&&f<Y){$+=R.suffixes[D],V>0&&(f=f/V);break}return w=c._.numberToFormat(f,b,h),w+$},unformat:function(f){var b=c._.stringToNumber(f),h,w;if(b){for(h=a.suffixes.length-1;h>=0;h--){if(c._.includes(f,a.suffixes[h])){w=Math.pow(a.base,h);break}if(c._.includes(f,u.suffixes[h])){w=Math.pow(u.base,h);break}}b*=w||1}return b}})}(),function(){c.register("format","currency",{regexps:{format:/(\$)/},format:function(a,u,y){var v=c.locales[c.options.currentLocale],f={before:u.match(/^([\+|\-|\(|\s|\$]*)/)[0],after:u.match(/([\+|\-|\)|\s|\$]*)$/)[0]},b,h,w;for(u=u.replace(/\s?\$\s?/,""),b=c._.numberToFormat(a,u,y),a>=0?(f.before=f.before.replace(/[\-\(]/,""),f.after=f.after.replace(/[\-\)]/,"")):a<0&&!c._.includes(f.before,"-")&&!c._.includes(f.before,"(")&&(f.before="-"+f.before),w=0;w<f.before.length;w++)switch(h=f.before[w],h){case"$":b=c._.insert(b,v.currency.symbol,w);break;case" ":b=c._.insert(b," ",w+v.currency.symbol.length-1);break}for(w=f.after.length-1;w>=0;w--)switch(h=f.after[w],h){case"$":b=w===f.after.length-1?b+v.currency.symbol:c._.insert(b,v.currency.symbol,-(f.after.length-(1+w)));break;case" ":b=w===f.after.length-1?b+" ":c._.insert(b," ",-(f.after.length-(1+w)+v.currency.symbol.length-1));break}return b}})}(),function(){c.register("format","exponential",{regexps:{format:/(e\+|e-)/,unformat:/(e\+|e-)/},format:function(a,u,y){var v,f=typeof a=="number"&&!c._.isNaN(a)?a.toExponential():"0e+0",b=f.split("e");return u=u.replace(/e[\+|\-]{1}0/,""),v=c._.numberToFormat(Number(b[0]),u,y),v+"e"+b[1]},unformat:function(a){var u=c._.includes(a,"e+")?a.split("e+"):a.split("e-"),y=Number(u[0]),v=Number(u[1]);v=c._.includes(a,"e-")?v*=-1:v;function f(b,h,w,R){var $=c._.correctionFactor(b,h),D=b*$*(h*$)/($*$);return D}return c._.reduce([y,Math.pow(10,v)],f,1)}})}(),function(){c.register("format","ordinal",{regexps:{format:/(o)/},format:function(a,u,y){var v=c.locales[c.options.currentLocale],f,b=c._.includes(u," o")?" ":"";return u=u.replace(/\s?o/,""),b+=v.ordinal(a),f=c._.numberToFormat(a,u,y),f+b}})}(),function(){c.register("format","percentage",{regexps:{format:/(%)/,unformat:/(%)/},format:function(a,u,y){var v=c._.includes(u," %")?" ":"",f;return c.options.scalePercentBy100&&(a=a*100),u=u.replace(/\s?\%/,""),f=c._.numberToFormat(a,u,y),c._.includes(f,")")?(f=f.split(""),f.splice(-1,0,v+"%"),f=f.join("")):f=f+v+"%",f},unformat:function(a){var u=c._.stringToNumber(a);return c.options.scalePercentBy100?u*.01:u}})}(),function(){c.register("format","time",{regexps:{format:/(:)/,unformat:/(:)/},format:function(a,u,y){var v=Math.floor(a/60/60),f=Math.floor((a-v*60*60)/60),b=Math.round(a-v*60*60-f*60);return v+":"+(f<10?"0"+f:f)+":"+(b<10?"0"+b:b)},unformat:function(a){var u=a.split(":"),y=0;return u.length===3?(y=y+Number(u[0])*60*60,y=y+Number(u[1])*60,y=y+Number(u[2])):u.length===2&&(y=y+Number(u[0])*60,y=y+Number(u[1])),Number(y)}})}(),c})})(xn);var Nr=xn.exports;const wn=mn(Nr);function Fr(p){const c=En(p)*1e3;let _="m",M="0,0",L,N="ft",A="0,0",P;return L=c,c>=1e3&&(L=c/1e3,_="km",M="0.00"),P=c*3.28084,P>=5280&&(P/=5280,N="mi",A="0.00"),{metric:`${wn(L).format(M)} ${_}`,standard:`${wn(P).format(A)} ${N}`}}function Tn(p){const c=p.geometry.coordinates[0],_=En(p);return Sr(c,_)}const Ar={...bn.modes.draw_line_string,clickAnywhere:function(p,c){return p.currentVertexPosition===1?(p.line.addCoordinate(0,c.lngLat.lng,c.lngLat.lat),this.changeMode("simple_select",{featureIds:[p.line.id]})):(p.line.updateCoordinate(p.currentVertexPosition,c.lngLat.lng,c.lngLat.lat),p.direction==="forward"?(p.currentVertexPosition+=1,p.line.updateCoordinate(p.currentVertexPosition,c.lngLat.lng,c.lngLat.lat)):p.line.addCoordinate(0,c.lngLat.lng,c.lngLat.lat),null)},onStop:function(p){if(this.activateUIButton(),this.getFeature(p.line.id)!==void 0)if(p.line.removeCoordinate("0"),p.line.isValid()){const c=p.line.toGeoJSON(),_=Tn(c);this.map.fire("draw.create",{features:[_]})}else this.deleteFeature([p.line.id],{silent:!0}),this.changeMode("simple_select",{},{silent:!0})},toDisplayFeatures:function(p,c,_){if(c.geometry.coordinates.length<2)return null;_({type:"Feature",properties:{active:"true"},geometry:{type:"Point",coordinates:c.geometry.coordinates[0]}}),c.properties.active="true",_(c);const L={type:"Feature",properties:{meta:"currentPosition",radius:`${Fr(c).metric}`,parent:p.line.id},geometry:{type:"Point",coordinates:c.geometry.coordinates[1]}};_(L);const N=Tn(c);return N.properties={active:"true"},_(N),null}};bn.lib.theme.map(p=>p.id==="gl-draw-line-inactive"?{...p,filter:[...p.filter,["!=","user_isSnapGuide","true"]]}:p);const kr=[{id:"gl-draw-line-inactive",type:"line",filter:["!=","user_isSnapGuide","true"]},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}},{id:"gl-draw-symbol",type:"symbol",layout:{"text-line-height":1.1,"text-size":15,"text-font":["DIN Pro Medium","Arial Unicode MS Regular"],"text-anchor":"left","text-justify":"left","text-offset":[.8,.8],"text-field":["get","radius"],"text-max-width":7},paint:{"text-color":"hsl(0, 0%, 95%)","text-halo-color":"hsl(0, 5%, 0%)","text-halo-width":1,"text-halo-blur":1},filter:["==","meta","currentPosition"]},{id:"guide",type:"line",filter:["all",["==","$type","LineString"],["==","user_isSnapGuide","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#c00c00","line-width":1,"line-dasharray":[5,5]}},{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","user_type","overlay"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.2}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"],["!=","user_type","overlay"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.2}},{id:"gl-draw-overlay-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["==","user_type","overlay"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.01}},{id:"gl-draw-overlay-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"],["==","user_type","overlay"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.01}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","user_type","overlay"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":4,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":2,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-and-line-vertex-scale-icon",type:"symbol",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"],["has","heading"]],layout:{"icon-image":"scale","icon-allow-overlap":!0,"icon-ignore-placement":!0,"icon-rotation-alignment":"map","icon-rotate":["get","heading"]},paint:{"icon-opacity":1,"icon-opacity-transition":{delay:0,duration:0}}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":4,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":2,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}},{id:"gl-draw-line-rotate-point",type:"line",filter:["all",["==","meta","midpoint"],["==","icon","rotate"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-rotate-point-stroke",type:"circle",filter:["all",["==","meta","midpoint"],["==","icon","rotate"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":4,"circle-color":"#fff"}},{id:"gl-draw-polygon-rotate-point",type:"circle",filter:["all",["==","meta","midpoint"],["==","icon","rotate"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":2,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-rotate-point-icon",type:"symbol",filter:["all",["==","meta","midpoint"],["==","icon","rotate"],["==","$type","Point"],["!=","mode","static"]],layout:{"icon-image":"rotate","icon-allow-overlap":!0,"icon-ignore-placement":!0,"icon-rotation-alignment":"map","icon-rotate":["get","heading"]},paint:{"icon-opacity":1,"icon-opacity-transition":{delay:0,duration:0}}},{id:"gl-draw-line-active-length",type:"symbol",filter:["all",["==","$type","LineString"],["==","active","true"],["==","user_has_length","true"]],layout:{"symbol-placement":"line-center","text-rotation-alignment":"map","text-pitch-alignment":"viewport","text-max-angle":30,"text-max-width":300,"text-field":"{user_length} {user_length_unit}","text-size":["interpolate",["linear"],["zoom"],8,8,10,12,16,16],"text-allow-overlap":!1},paint:{"text-opacity":["interpolate",["linear"],["zoom"],8,1],"text-color":"#000","text-halo-color":["interpolate",["linear"],["zoom"],2,"#ffffff",3,"#ffffff"],"text-halo-width":.3,"text-halo-blur":1}},{id:"gl-draw-polygon-active-length",type:"symbol",filter:["all",["==","$type","Polygon"],["==","active","true"],["==","user_has_length","true"]],layout:{"symbol-placement":"line-center","text-rotation-alignment":"map","text-pitch-alignment":"viewport","text-max-angle":30,"text-max-width":300,"text-field":"{user_length} {user_length_unit}","text-size":["interpolate",["linear"],["zoom"],8,8,10,12,16,16],"text-allow-overlap":!1},paint:{"text-opacity":["interpolate",["linear"],["zoom"],8,1],"text-color":"#000","text-halo-color":["interpolate",["linear"],["zoom"],2,"#ffffff",3,"#ffffff"],"text-halo-width":.3,"text-halo-blur":1}},{id:"gl-draw-polygon-active-area",type:"symbol",filter:["all",["==","$type","Polygon"],["==","active","true"],["==","user_has_area","true"]],layout:{"symbol-placement":"line","text-rotation-alignment":"map","text-pitch-alignment":"viewport","text-max-angle":30,"text-max-width":300,"text-field":"{user_area} meters^2","text-size":["interpolate",["linear"],["zoom"],8,8,10,12,16,16],"text-allow-overlap":!1},paint:{"text-opacity":["interpolate",["linear"],["zoom"],8,1],"text-color":"#000","text-halo-color":["interpolate",["linear"],["zoom"],2,"#ffffff",3,"#ffffff"],"text-halo-width":.3,"text-halo-blur":1}}],Rr={CircleMode:Ar};Ue.default=Rr,Ue.drawStyles=kr,Object.defineProperties(Ue,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=index.umd.js.map
